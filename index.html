<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Consultas Internas - Galv√£o Drones</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230E5847'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v4h4v2h-4v4h-2v-4H7v-2h4V8z'%3E%3C/path%3E%3Cpath d='M13.25 7.15c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L8.4 9.16c-.24.24-.36.58-.36.92s.12.68.36.92l.71.71c.24.24.58.36.92.36s.68-.12.92-.36l2.93-2.93c.24-.24.36-.58.36-.92s-.12-.68-.36-.92l-.71-.71zM10.75 16.85c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36l-2.93 2.93c-.24.24-.36.58-.36.92s.12.68.36.92l.71.71zM18.8 8.4l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L13.3 9.77c-.24.24-.36.58-.36.92s.12.68.36.92l.71.71c.24.24.58.36.92.36s.68-.12.92-.36l3.85-3.85c.24-.24.36-.58.36-.92s-.12-.68-.36-.92zM5.2 15.6l.71.71c.24.24.58.36.92.36s.68-.12.92.36l3.85-3.85c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L5.2 14.68c-.24.24-.36.58-.36.92s.12.68.36.92z'%3E%3C/path%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        /* --- ESTILOS GERAIS (CSS) COM A PALETA GALV√ÉO DRONES --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --primary-color: #EF7E13; /* Laranja Galv√£o Drones */
            --secondary-color: #0E5847; /* Verde Galv√£o Drones */
            --light-grey: #f4f7f6;
            --medium-grey: #ecf0f1;
            --dark-grey: #bdc3c7;
            --danger-color: #e74c3c;
            --whatsapp-color: #25D366;
            --instagram-color: #C13584; /* Cor do Instagram */
            --youtube-color: #FF0000; /* Cor do YouTube */
            --help-color: #5865F2;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--light-grey);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative; /* Adicionado para o pseudo-elemento */
        }

        /* Adiciona a imagem de fundo com opacidade */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.pexels.com/photos/2246476/pexels-photo-2246476.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1; /* Opacidade da imagem de fundo */
            z-index: -1;
            transition: background-image 0.5s ease-in-out, opacity 0.5s ease-in-out; /* Adiciona transi√ß√£o */
        }

        /* Nova classe para o fundo do modo visitante */
        body.visitor-mode-bg::before {
            background-image: url('https://i.imgur.com/b3lg2eE.png'); /* URL da sua logo no Imgur */
            background-size: contain; /* Ajusta a imagem para caber sem cortar */
            background-position: center center; /* Centraliza a imagem */
            background-repeat: no-repeat; /* Evita repeti√ß√£o */
            opacity: 0.5; /* Ajuste a opacidade conforme preferir */
        }


        .container {
            width: 100%;
            max-width: 1200px;
            margin: 20px;
            z-index: 1;
        }

        /* --- TELA DE LOGIN --- */
        #login-screen {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            transition: opacity 0.5s ease;
            margin: auto; /* Garante centraliza√ß√£o */
        }
        #company-logo {
            max-width: 300px; /* Ajuste a largura m√°xima conforme necess√°rio */
            width: 80%;
            display: block;
            margin: 0 auto 10px auto; /* Centraliza a imagem e adiciona margem inferior */
        }
        #portal-subtitle {
             color: #555;
             margin-top: 0;
             margin-bottom: 40px;
             font-size: 1.2em;
             font-weight: 400;
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
        }
        .action-button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px; /* Adicionado para separar bot√µes */
        }
        .action-button:hover {
            opacity: 0.9;
        }
        #login-error {
            color: var(--danger-color);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }
        #visitor-mode-button {
            background-color: var(--dark-grey);
        }
        #visitor-mode-button:hover {
            background-color: #95a5a6;
        }


        /* --- TELA PRINCIPAL DO APP --- */
        #app-screen {
            display: none; /* Come√ßa escondida */
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: opacity 0.5s ease;
        }
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px; /* Altura fixa para o header */
        }
        .header-left { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            height: 100%; /* Ocupa a altura do header */
        }
        #nav-toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0 10px;
            margin-right: 15px; /* Adicionado para separar do t√≠tulo */
            height: 100%; /* Para alinhar verticalmente */
            display: flex; /* Para alinhar o √≠cone */
            align-items: center; /* Para alinhar o √≠cone */
            z-index: 1001; /* Acima do menu para ser clic√°vel */
        }
        header h1 {
            margin: 0;
            font-size: 24px;
        }
        /* MODIFICADO: Estilos para o bot√£o de logout. Agora o display √© controlado via JS */
        header #logout-button {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            display: none; /* Escondido por padr√£o no CSS, JS controla */
        }
        header #logout-button:hover {
            background-color: #c0392b;
        }

        /* Removido o display: none para o logout-button na classe visitor-header */
        .visitor-header #welcome-message {
            display: none; /* Mant√©m a welcome message escondida para visitantes */
        }

        /* NOVO: Estilo para o link de altera√ß√£o de senha no header */
        #change-password-link {
            font-size: 0.8em;
            color: #ccc;
            text-decoration: underline;
            cursor: pointer;
            margin-left: 10px; /* Espa√ßo da mensagem de boas-vindas */
            display: none; /* Escondido por padr√£o, JS controla */
        }
        #change-password-link:hover {
            color: white;
        }


        .app-body {
            display: flex;
            position: relative; /* Para o main-content n√£o empurrar a nav */
            min-height: calc(100vh - 60px); /* Ajusta a altura para caber o header */
        }
        nav {
            width: 200px;
            min-width: 200px;
            background-color: var(--medium-grey);
            padding: 20px 0;
            border-right: 1px solid var(--dark-grey);
            transition: transform 0.3s ease;
            box-sizing: border-box; /* Garante que padding n√£o adicione largura */
            display: flex; /* Para controlar a ordem dos bot√µes com flex-order */
            flex-direction: column; /* Para empilhar os bot√µes verticalmente */
            flex-shrink: 0; /* Previne que a nav encolha */
        }

        /* NOVO: Estilos para o grupo de navega√ß√£o e sub-navega√ß√£o */
        .nav-item-group {
            width: 100%;
            position: relative; /* Para posicionamento de sub-menus */
        }

        .sub-nav {
            background-color: var(--dark-grey); /* Fundo diferente para sub-menu */
            padding-left: 10px; /* Indenta√ß√£o para sub-itens */
        }

        .sub-nav-button {
            font-size: 0.95em; /* Fonte menor para sub-itens */
            padding: 10px 20px; /* Ajuste de padding */
            border-bottom: 1px solid #c0c0c0; /* Linha divis√≥ria mais clara */
        }
        .sub-nav-button:last-child {
            border-bottom: none;
        }
        .sub-nav-button.active, .sub-nav-button:hover {
            background-color: #a0a0a0; /* Cor mais escura no hover/active do sub-item */
            color: white;
        }


        /* Oculta nav por padr√£o no mobile, prepara para slide-in */
        @media (max-width: 768px) {
            nav {
                position: fixed; /* Fixa a nav sobre o conte√∫do */
                top: 0; /* Come√ßa no topo da viewport */
                left: 0;
                height: 100vh; /* Altura total da viewport */
                width: 250px; /* Largura da nav quando aberta */
                min-width: 250px;
                transform: translateX(-100%); /* Come√ßa fora da tela (escondida) */
                z-index: 999; /* Garante que fique acima de outros elementos */
                box-shadow: 2px 0 5px rgba(0,0,0,0.2); /* Sombra para destacar */
                padding-top: 60px; /* Espa√ßo para o cabe√ßalho do app, que tem 60px de altura */
                border-right: 1px solid var(--dark-grey); /* Mant√©m borda */
            }
            nav.nav-open { /* Classe para quando a nav est√° aberta */
                transform: translateX(0); /* Desliza para dentro da tela */
            }
            .nav-header {
                display: flex; /* Mostra o cabe√ßalho da nav no mobile */
                position: absolute; /* Fixa o cabe√ßalho no topo da nav */
                top: 0;
                width: 100%;
                height: 60px; /* Mesma altura do header principal */
                background-color: var(--secondary-color); /* Cor de fundo para o cabe√ßalho da nav */
                color: white;
                padding: 15px 20px;
                box-sizing: border-box;
                align-items: center;
            }
            .nav-header #nav-toggle-btn-close {
                font-size: 24px;
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                padding: 0 10px;
            }
             .nav-header span {
                flex-grow: 1;
                text-align: center;
                margin-left: -20px; /* Ajuste para centralizar o texto "Menu" */
                font-size: 1.2em; /* Tamanho do t√≠tulo do menu */
            }
            .app-body {
                flex-direction: column; /* Pilha itens verticalmente no mobile */
                min-height: calc(100vh - 60px); /* Reduz min-height para acomodar o header fixo */
            }

            /* NOVO: Ajustes para garantir que o conte√∫do principal use a largura total no mobile */
            main {
                width: 100%;
                box-sizing: border-box; /* Inclui padding na largura total */
            }
        }

        nav button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            background: none;
            border: none;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.3s, color 0.3s;
        }
        nav button.active, nav button:hover {
            background-color: var(--dark-grey);
            color: var(--secondary-color);
            font-weight: 700;
        }
        /* Oculta o cabe√ßalho da nav no desktop */
        .nav-header {
            display: none; 
            align-items: center;
            padding: 15px 20px;
            background-color: var(--dark-grey);
            color: var(--secondary-color);
            font-weight: 700;
        }
        .nav-header span {
            margin-left: 10px;
        }

        main {
            flex-grow: 1;
            padding: 30px;
            max-height: calc(100vh - 60px); /* Ajusta max-height para acomodar o header fixo */
            overflow-y: auto;
            position: relative;
            transition: margin-left 0.3s ease;
        }
        @media (max-width: 768px) {
            main {
                padding: 20px;
                max-height: calc(100vh - 60px); /* Ajusta a altura da √°rea de conte√∫do para caber o header */
                width: 100%; /* Ocupa a largura total */
            }
            header {
                padding: 10px 15px;
                position: sticky; /* Fixa o header no topo */
                top: 0;
                z-index: 100; /* Garante que o header fique sobre o conte√∫do */
            }
            header h1 {
                font-size: 20px;
            }
            #nav-toggle-btn {
                margin-right: 0; /* Remove a margem extra no mobile */
                z-index: 1000; /* Garante que o bot√£o esteja sempre vis√≠vel no topo */
            }
            .header-left {
                gap: 10px;
                flex-grow: 1; /* Permite que o welcome message ocupe o espa√ßo */
            }
            #welcome-message {
                margin-left: 0; /* Ajusta a margem para telas menores */
                flex-grow: 1; /* Permite que ocupe o espa√ßo */
            }
        }


        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .content-section h2, .content-section h3 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            color: var(--secondary-color);
        }
        .content-section h3 {
             border-bottom: 1px solid var(--dark-grey);
             font-size: 1.2em;
             margin-top: 30px;
        }

        /* --- Barra de Pesquisa --- */
        .search-bar {
            margin-bottom: 20px;
            position: relative;
        }
        .search-bar input {
            width: 100%; padding: 12px 12px 12px 40px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;
        }
        .search-bar::before {
            content: 'üîé'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.6;
        }
        
        /* --- ESTILOS DOS CARDS --- */
        .card {
            position: relative; /* Necess√°rio para o pseudo-elemento */
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
            transition: box-shadow 0.3s;
            z-index: 1; /* Garante que o conte√∫do fique acima do background */
        }

        .card::before {
            content: ""; /* Fundamental para o pseudo-elemento aparecer */
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("logo.png");
            background-size: 50%;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.15; /* Ajuste este valor para a opacidade desejada */
            z-index: -1; /* Envia o background para tr√°s do conte√∫do */
            border-radius: 5px; /* Mant√©m o mesmo border-radius do card */
        }
        .card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .card h3 { margin-top: 0; color: var(--secondary-color); border: none; font-size: 1.3em; } /* Ajuste de fonte */
        .product-card { border-left: 5px solid var(--primary-color); }
        .supplier-card { border-left: 5px solid var(--secondary-color); }
        .info-card { border-left: 5px solid var(--secondary-color); }
        .product-spec { white-space: pre-wrap; line-height: 1.6; font-size: 0.95em; } /* Ajuste de fonte */

        .price { font-size: 1.2em; font-weight: 700; color: #27ae60; }
        .cost-price { font-size: 1.1em; font-weight: 700; color: var(--danger-color); background-color: #fdd; padding: 5px; border-radius: 4px; display: inline-block; margin-top: 10px; }
        .supplier-info { font-size: 0.9em; font-weight: 500; color: var(--secondary-color); background-color: #e8f8f5; padding: 5px 8px; border-radius: 4px; display: inline-block; margin-top: 10px; margin-left: 10px;}
        
        /* NOVO: Estilos para a lista de fornecedores por produto */
        .product-suppliers-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
            font-size: 0.9em;
        }
        .product-suppliers-list li {
            background-color: #f8f8f8;
            padding: 5px 10px;
            border-radius: 3px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #eee;
        }
        .product-suppliers-list li .supplier-name-link {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: bold;
        }
        .product-suppliers-list li .supplier-name-link:hover {
            text-decoration: underline;
        }
        .product-suppliers-list li .cost-value {
            color: var(--danger-color);
            font-weight: 500;
        }


        /* --- BOT√ïES DE A√á√ÉO DO PRODUTO --- */
        .action-buttons-container { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .action-buttons-container button, .action-buttons-container a.action-button {
            color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 500; transition: background-color 0.3s;
            font-size: 0.9em; /* Ajuste de fonte */
            text-decoration: none; /* Para os links */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .gemini-button { background-color: var(--secondary-color); }
        .whatsapp-button { background-color: var(--whatsapp-color); }
        .instagram-button { background-color: var(--instagram-color); } /* Estilo para bot√£o Instagram */
        .youtube-button { background-color: var(--youtube-color); } /* Estilo para bot√£o YouTube */
        .google-maps-button { background-color: #4285F4; } /* Estilo para bot√£o Google Maps */

        .help-button { background-color: var(--help-color); }
        .action-buttons-container button:hover, .action-buttons-container a.action-button:hover { opacity: 0.9; }

        /* --- CALCULADORA --- */
        .calculator-container { margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--dark-grey); }
        .payment-method-selector label { display: inline-block; margin-right: 15px; cursor: pointer; font-size: 0.95em; }
        .payment-method-selector input { margin-right: 5px; }
        .installments-container { margin-top: 10px; }
        .calculate-product-btn { background-color: var(--secondary-color); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px;}
        .product-calculator-result, #general-calculator-result { margin-top: 15px; font-size: 1.1em; color: var(--secondary-color); background-color: #eaf5ff; padding: 15px; border-radius: 5px; }
        .result-vista { font-weight: bold; }
        .result-parcelado { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--dark-grey); }
        .result-parcelado small { font-size: 0.9em; font-weight: normal; color: #555; }
        
        /* Estilos para o desconto √† vista */
        .discount-option {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative; /* Para posicionar o texto opaco */
        }
        .discount-option input[type="number"] {
            width: 80px; /* Ajuste a largura conforme necess√°rio */
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: transparent; /* Permite ver o fundo com a marca d'√°gua */
            position: relative; /* Para estar acima do pseudo-elemento */
            z-index: 1; /* Garante que o input esteja por cima */
        }
        .discount-option label {
            margin-bottom: 0; /* Remover margem inferior do label */
        }
        /* Texto opaco de "max. 15%" */
        .discount-option::after {
            content: "max. 15%";
            position: absolute;
            left: 105px; /* Ajuste para alinhar com o input */
            color: #ccc; /* Cor do texto opaco */
            font-size: 0.8em;
            opacity: 0.8; /* Opacidade do texto */
            pointer-events: none; /* N√£o interfere com o input */
            white-space: nowrap; /* Evita quebra de linha */
            transform: translateY(2px); /* Pequeno ajuste vertical */
            z-index: 0; /* Fica abaixo do input */
        }


        /* --- MODAL E SCROLL TO TOP --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); padding-top: 60px; }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .loader { border: 8px solid #f3f3f3; border-radius: 50%; border-top: 8px solid var(--primary-color); width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #scroll-to-top { position: fixed; bottom: 20px; right: 30px; z-index: 99; border: none; outline: none; background-color: var(--primary-color); color: white; cursor: pointer; padding: 12px 15px; border-radius: 50%; font-size: 18px; display: none; }

        /* --- GEST√ÉO DE USU√ÅRIOS --- */
        #temp-user-list-container { margin-top: 30px; }
        .temp-user-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--medium-grey); }
        .temp-user-item:last-child { border-bottom: none; }
        .user-info p { margin: 0; }
        .user-info p small { color: #555; }
        .user-actions button { margin-left: 10px; padding: 5px 10px; border-radius: 4px; border: none; color: white; cursor: pointer; }
        .edit-btn { background-color: var(--primary-color); }
        .delete-btn { background-color: var(--danger-color); }

        .hidden { display: none !important; }

        /* --- BOT√ÉO FLUTUANTE DE CHAT AI --- */
        #ai-chat-button {
            position: fixed;
            bottom: 90px; /* Ajuste para n√£o colidir com o "Scroll to Top" */
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: var(--secondary-color); /* Verde Galv√£o Drones */
            color: white;
            cursor: pointer;
            padding: 15px 18px;
            border-radius: 50%;
            font-size: 24px;
            display: none; /* Inicia escondido */
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background-color 0.3s, transform 0.3s;
        }

        #ai-chat-button:hover {
            background-color: #0A4538; /* Um tone mais escuro do verde */
            transform: translateY(-3px);
        }

        #ai-chat-button:active {
            transform: translateY(0);
        }

        /* Estilos espec√≠ficos para o modal de chat AI, se necess√°rio */
        #ai-chat-modal .modal-content {
            max-width: 700px;
        }

        #ai-chat-modal-body {
            text-align: left;
        }

        #ai-question-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
            margin-bottom: 15px;
        }

        #submit-ai-question {
            width: auto;
            padding: 10px 20px;
            font-size: 1em;
        }

        #ai-response-area {
            white-space: pre-wrap; /* Mant√©m quebras de linha e espa√ßos */
            max-height: 300px; /* Limita a altura da resposta */
            overflow-y: auto; /* Adiciona scroll se a resposta for longa */
            border: 1px solid #ddd;
            padding: 10px; /* Adicionado padding para melhor leitura */
        }

        /* NOVO: Estilos para o modal de senha do fornecedor */
        #supplier-password-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }
        #supplier-password-modal .input-group input {
            text-align: center;
        }
        #supplier-password-modal .error-message {
            color: var(--danger-color);
            margin-top: 10px;
            display: none;
        }

        /* NOVO: Modal de Altera√ß√£o de Senha */
        #change-password-modal .modal-content {
            max-width: 450px;
            text-align: center;
        }
        #change-password-modal .input-group {
            margin-bottom: 15px;
        }
        #change-password-modal .input-group label {
            font-size: 0.9em;
        }
        #change-password-modal .error-message {
            color: var(--danger-color);
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }
        #change-password-modal .success-message {
            color: var(--secondary-color);
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }


        /* NOVO: Estilos para elementos em modo retrato */
        @media (max-width: 768px) {
            /* Alinhamento geral para conte√∫do principal */
            main .content-section > * {
                margin-left: auto;
                margin-right: auto;
                max-width: 100%; /* Garante que elementos n√£o ultrapassem a tela */
                padding: 0 10px; /* Padding interno para evitar que o conte√∫do cole nas bordas */
                box-sizing: border-box;
            }

            /* Cart√µes de produtos/fornecedores/info */
            .card {
                padding: 15px; /* Reduz padding em telas menores */
                margin-bottom: 10px; /* Espa√ßamento menor entre cards */
            }

            .card h3 {
                font-size: 1.1em; /* Ajusta tamanho do t√≠tulo do card */
            }

            .product-spec, .price, .cost-price, .supplier-info {
                font-size: 0.9em; /* Fontes um pouco menores para caber melhor */
            }

            /* Bot√µes de a√ß√£o dentro dos cards */
            .action-buttons-container {
                flex-direction: column; /* Empilha os bot√µes verticalmente */
                gap: 8px; /* Reduz o espa√ßamento entre eles */
            }
            .action-buttons-container button, .action-buttons-container a.action-button {
                width: 100%; /* Ocupa a largura total do container */
                padding: 10px; /* Ajusta o padding dos bot√µes */
                font-size: 0.9em;
            }

            /* Calculadora dentro dos cards */
            .calculator-container .input-group {
                margin-bottom: 10px; /* Reduz espa√ßamento entre grupos de input */
            }
            .payment-method-selector label {
                margin-right: 10px;
                font-size: 0.9em;
            }
            .discount-option {
                flex-direction: column; /* Empilha label e input */
                align-items: flex-start; /* Alinha ao in√≠cio */
                gap: 5px;
            }
            .discount-option input[type="number"] {
                width: 100px; /* Mant√©m uma largura razo√°vel */
                padding: 5px;
            }
            .discount-option::after {
                left: 0; /* Alinha o texto opaco */
                top: auto;
                bottom: -15px; /* Posiciona abaixo do input */
                transform: none;
            }
            .calculate-product-btn {
                width: 100%; /* Bot√£o de calcular ocupa toda a largura */
                padding: 10px;
            }
            .product-calculator-result, #general-calculator-result {
                font-size: 1em;
                padding: 10px;
            }
            .result-parcelado small {
                font-size: 0.8em;
            }

            /* Campos de pesquisa */
            .search-bar input {
                padding: 10px 10px 10px 35px; /* Ajusta padding para √≠cone de busca */
                font-size: 0.95em;
            }
            .search-bar::before {
                left: 10px;
                font-size: 16px;
            }

            /* Gest√£o de Usu√°rios Tempor√°rios */
            .temp-user-item {
                flex-direction: column; /* Empilha informa√ß√µes e a√ß√µes */
                align-items: flex-start; /* Alinha ao in√≠cio */
                padding: 10px;
            }
            .user-info p {
                font-size: 0.95em;
            }
            .user-actions {
                width: 100%;
                display: flex;
                justify-content: flex-start; /* Alinha bot√µes ao in√≠cio */
                margin-top: 10px;
            }
            .user-actions button {
                margin-left: 0; /* Remove margem lateral */
                margin-right: 10px; /* Adiciona espa√ßamento entre bot√µes */
                padding: 8px 10px;
                font-size: 0.9em;
            }

            /* Informa√ß√µes da Empresa */
            .info-card p {
                font-size: 0.95em;
            }
            .contact-buttons-container {
                flex-direction: column; /* Empilha os bot√µes de contato */
                gap: 8px;
            }
            .contact-buttons-container a.action-button {
                width: 100%; /* Ocupa a largura total */
            }

            /* Modal da IA */
            #ai-chat-modal .modal-content {
                width: 90%; /* Aumenta a largura do modal no mobile */
                margin: 20px auto; /* Mais espa√ßo nas bordas */
            }
            #ai-question-input {
                font-size: 0.95em;
            }
            #ai-response-area {
                font-size: 0.9em;
                padding: 8px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen">
            <img src="https://i.imgur.com/b3lg2eE.png" alt="Logotipo Galv√£o Drones" id="company-logo">
            <h2 id="portal-subtitle">Portal Interno</h2>
            <div class="input-group"><label for="username">Usu√°rio</label><input type="text" id="username" placeholder="Digite seu nome"></div>
            <div class="input-group"><label for="password">Senha</label><input type="password" id="password" placeholder="Sua senha"></div>
            <button id="login-button" class="action-button">Entrar</button>
            <button id="visitor-mode-button" class="action-button">Modo Visitante</button>
            <p id="login-error">Usu√°rio ou senha inv√°lidos.</p>
        </div>

        <div id="app-screen">
            <header>
                <div class="header-left">
                    <button id="nav-toggle-btn" class="nav-toggle-btn">‚ò∞</button>
                    <span id="welcome-message"></span>
                    <span id="change-password-link">Alterar Senha</span>
                    <h1>Portal Interno</h1>
                </div>
                <div>
                    <button id="logout-button">Sair</button>
                </div>
            </header>
            <div class="app-body">
                <nav>
                    <div class="nav-header">
                        <button id="nav-toggle-btn-close" class="nav-toggle-btn">‚úï</button>
                        <span>Menu</span>
                    </div>
                    <button class="nav-button" data-section="products-section" id="products-nav-button" style="order: 1;">Produtos</button>
                    <button class="nav-button" data-section="calculator-section" id="calculator-nav-button" style="order: 2;">Calculadora</button>
                    <button class="nav-button" data-section="suppliers-section" id="suppliers-nav-button" style="order: 3;">Fornecedores</button>
                    
                    <div class="nav-item-group" style="order: 4;">
                        <button class="nav-button" data-section="settings-section" id="settings-nav-button">Configura√ß√µes</button>
                        <div class="sub-nav" id="settings-sub-nav" style="display: none;">
                            <button class="nav-button sub-nav-button" data-section="manage-users-section" id="manage-users-nav-button">Gerir Usu√°rios</button>
                            <button class="nav-button sub-nav-button" data-section="create-product-section" id="create-product-nav-button">Criar Produto</button>
                            <button class="nav-button sub-nav-button" data-section="edit-product-section" id="edit-product-nav-button">Alterar Produto</button>
                        </div>
                    </div>
                    
                    <button class="nav-button" data-section="drones-visitor-section" id="drones-nav-button" style="order: 5;">Drones</button>
                    <button class="nav-button" data-section="info-section" id="info-empresa-nav-button" style="order: 6;">Info Empresa</button>
                </nav>
                <main id="main-content">
                    <section id="products-section" class="content-section">
                        <h2>Consulta de Produtos</h2>
                        <div class="search-bar"><input type="text" id="product-search" placeholder="Pesquisar por nome ou especifica√ß√£o..."></div>
                        <div id="product-list"></div>
                    </section>
                    <section id="calculator-section" class="content-section">
                        <h2>Calculadora Geral</h2>
                        <div class="card">
                           <div class="input-group">
                                <label for="general-valor-base">Valor Base</label>
                                <input type="number" id="general-valor-base" class="input-full" placeholder="Digite o valor para simula√ß√£o">
                           </div>
                           <div class="input-group">
                                <label>Forma de Pagamento</label>
                                <div id="general-payment-method-selector">
                                    <input type="radio" id="general-payment-vista" name="general-payment-method" value="vista" checked>
                                    <label for="general-payment-vista">√Ä vista</label>
                                    <input type="radio" id="general-payment-parcelado" name="general-payment-method" value="parcelado">
                                    <label for="general-payment-parcelado">Parcelado</label>
                                </div>
                           </div>
                           <div class="input-group hidden" id="general-installments-container">
                                <label for="general-parcelas">N√∫mero de Parcelas</label>
                                <select id="general-parcelas">
                                    <option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="5">5x</option><option value="6">6x</option><option value="7">7x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option><option value="11">11x</option><option value="12">12x</option>
                                </select>
                           </div>
                           <button id="general-calculate-button" class="action-button" style="width: auto; padding: 10px 20px;">Calcular</button>
                           <div id="general-calculator-result">O resultado da simula√ß√£o aparecer√° aqui.</div>
                        </div>
                    </section>
                    <section id="suppliers-section" class="content-section"><h2>Fornecedores (Acesso Confidencial)</h2><div id="supplier-list"></div></section>
                    
                    <section id="settings-section" class="content-section active">
                        <h2>Configura√ß√µes do Sistema</h2>
                        <p>Selecione uma op√ß√£o de configura√ß√£o no menu lateral.</p>
                        </section>

                    <section id="manage-users-section" class="content-section">
                        <h2>Gerir Usu√°rios Tempor√°rios</h2>
                        <div class="card">
                            <h3>Criar Usu√°rio Tempor√°rio</h3>
                            <form id="create-temp-user-form">
                                <div class="input-group"><label for="temp-username">Nome de Usu√°rio</label><input type="text" id="temp-username" required></div>
                                <div class="input-group"><label for="temp-password">Senha</label><input type="text" id="temp-password" required></div>
                                <div class="input-group"><label for="temp-duration">Dura√ß√£o do Acesso</label><select id="temp-duration"><option value="1">1 Hora</option><option value="8">8 Horas</option><option value="24" selected>24 Horas</option><option value="72">72 Horas</option></select></div>
                                <button type="submit" class="action-button">Criar Usu√°rio</button>
                                <p id="temp-user-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                        <div id="temp-user-list-container">
                            <h3>Usu√°rios Tempor√°rios Ativos</h3>
                            <div id="temp-user-list" class="card"></div>
                        </div>
                    </section>

                    <section id="create-product-section" class="content-section">
                        <h2>Criar Novo Produto</h2>
                        <div class="card">
                            <form id="create-product-form">
                                <div class="input-group"><label for="new-product-name">Nome do Produto</label><input type="text" id="new-product-name" required></div>
                                <div class="input-group"><label for="new-product-spec">Especifica√ß√µes</label><textarea id="new-product-spec" rows="5" placeholder="Liste as especifica√ß√µes detalhadas"></textarea></div>
                                <div class="input-group"><label for="new-product-sale-price">Pre√ßo de Venda (R$)</label><input type="number" id="new-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="new-product-cost-price">Pre√ßo de Custo (R$)</label><input type="number" id="new-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group"><label for="new-product-supplier">Fornecedor Principal</label><input type="text" id="new-product-supplier" placeholder="Nome do fornecedor"></div>
                                <button type="submit" class="action-button">Salvar Novo Produto</button>
                                <p id="create-product-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                    </section>

                    <section id="edit-product-section" class="content-section">
                        <h2>Alterar Produto Existente</h2>
                        <div class="card">
                            <div class="input-group">
                                <label for="edit-product-search-id">Buscar por ID do Produto</label>
                                <input type="number" id="edit-product-search-id" placeholder="Digite o ID do produto">
                                <button id="search-product-to-edit" class="action-button" style="width: auto; margin-top: 10px;">Buscar</button>
                            </div>
                            <div id="edit-product-display" style="margin-top: 20px;">
                                <p>Use a busca acima para carregar os dados do produto.</p>
                            </div>
                            <form id="edit-product-form" class="hidden">
                                <input type="hidden" id="edit-product-id">
                                <div class="input-group"><label for="edit-product-name">Nome do Produto</label><input type="text" id="edit-product-name" required></div>
                                <div class="input-group"><label for="edit-product-spec">Especifica√ß√µes</label><textarea id="edit-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="edit-product-sale-price">Pre√ßo de Venda (R$)</label><input type="number" id="edit-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="edit-product-cost-price">Pre√ßo de Custo (R$)</label><input type="number" id="edit-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group"><label for="edit-product-supplier">Fornecedor Principal</label><input type="text" id="edit-product-supplier"></div>
                                <button type="submit" class="action-button">Salvar Altera√ß√µes</button>
                                <p id="edit-product-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                    </section>
                    <section id="drones-visitor-section" class="content-section">
                        <h2>Modelos de Drones</h2>
                        <div class="search-bar"><input type="text" id="drone-visitor-search" placeholder="Pesquisar por modelo ou especifica√ß√£o..."></div>
                        <div id="drone-visitor-list"></div>
                    </section>
                    <section id="info-section" class="content-section">
                        <h2>Informa√ß√µes da Empresa</h2>
                        <div class="card info-card">
                            <p><strong>Nome da Empresa:</strong> Galv√£o Drones</p>
                            <p id="cnpj-display-line"><strong>CNPJ:</strong> 60.102.179/0001-10</p>
                            <p><strong>Endere√ßo:</strong> Rua 16, n¬∫ 304 ‚Äì Setor Aerovi√°rio, Goi√¢nia ‚Äì GO, CEP: 74435-240</p>
                            <p><a href="https://www.google.com/maps/search/Galv%C3%A3o+Drones+em+Goi%C3%A2nia+Goi%C3%A1s" target="_blank" class="action-button google-maps-button" style="width: auto; padding: 10px 15px; margin-right: 10px;">Ver no Google Maps</a></p>
                            <p><strong>Contato:</strong> (62) 3636-0668</p>
                            <div class="contact-buttons-container" style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                                <a href="https://www.instagram.com/galvao_drones" target="_blank" class="action-button instagram-button" style="width: auto; padding: 10px 15px;">Instagram</a>
                                <a href="https://wa.me/556236360668" target="_blank" class="action-button whatsapp-button" style="width: auto; padding: 10px 15px;">WhatsApp</a>
                                <a href="https://www.youtube.com/@Galv%C3%A3oDronesofc" target="_blank" class="action-button youtube-button" style="width: auto; padding: 10px 15px;">YouTube</a>
                            </div>
                            <p><strong>Website:</strong> <a href="http://www.galvaodrones.com.br" target="_blank">www.galvaodrones.com.br</a></p>
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </div>
    
    <button id="scroll-to-top" title="Voltar ao topo">‚¨Ü</button>

    <button id="ai-chat-button" title="Falar com a IA">ü§ñ</button>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">√ó</span>
            <h3 id="modal-title">Aviso</h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <div id="ai-chat-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="ai-chat-close-button">√ó</span>
            <h3 id="ai-chat-modal-title">Assistente Galv√£o Drones</h3>
            <div id="ai-chat-modal-body">
                <div class="input-group">
                    <label for="ai-question-input">Qual a sua pergunta sobre drones ou Galv√£o Drones?</label>
                    <textarea id="ai-question-input" rows="5" placeholder="Ex: 'Quais drones s√£o ideais para filmagem profissional?' ou 'Qual o hor√°rio de funcionamento da loja?'"></textarea>
                </div>
                <button id="submit-ai-question" class="action-button">Perguntar</button>
                <div id="ai-response-area" style="margin-top: 20px; padding: 15px; background-color: #f0f0f0; border-radius: 5px; min-height: 50px; display: none;"></div>
                <div class="loader" id="ai-loader" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div id="supplier-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="supplier-password-close-button">√ó</span>
            <h3>Acesso Restrito</h3>
            <p>Por favor, digite a senha para acessar as informa√ß√µes de fornecedores:</p>
            <div class="input-group">
                <input type="password" id="supplier-access-password" placeholder="Digite a senha">
            </div>
            <button id="submit-supplier-password" class="action-button">Acessar</button>
            <p id="supplier-password-error" class="error-message">Senha incorreta.</p>
        </div>
    </div>

    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="change-password-close-button">√ó</span>
            <h3 id="change-password-modal-title">Alterar Senha</h3>
            <p id="change-password-message">Por favor, defina uma nova senha para sua conta.</p>
            <div class="input-group">
                <label for="new-password">Nova Senha (m√≠n. 6 d√≠gitos)</label>
                <input type="password" id="new-password">
            </div>
            <div class="input-group">
                <label for="confirm-new-password">Confirmar Nova Senha</label>
                <input type="password" id="confirm-new-password">
            </div>
            <button id="submit-change-password" class="action-button">Salvar Nova Senha</button>
            <p id="change-password-error" class="error-message">Senhas n√£o conferem ou s√£o muito curtas.</p>
            <p id="change-password-success" class="success-message">Senha alterada com sucesso!</p>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- BANCO DE DADOS SIMULADO ---
    const currentYear = new Date().getFullYear(); 

    const USERS = {
        'mikhaell': { password: 'mk0639', role: 'admin', type: 'permanent', firstLogin: false }, 
        'Maikhon':  { password: 'maik', role: 'admin', type: 'permanent', firstLogin: false },
        'Ryan':     { password: 'ryan', role: 'admin', type: 'permanent', firstLogin: false },
        'Fineias':  { password: 'fin', role: 'seller', type: 'permanent', firstLogin: false },
        'Rafael':   { password: 'raf', role: 'seller', type: 'permanent', firstLogin: false },
        'Eduardo':  { password: 'edu' + currentYear, role: 'seller', type: 'permanent', firstLogin: true }, // NOVO USU√ÅRIO COM firstLogin: true
        
        'mikhaellven': { password: 'mik' + currentYear, role: 'seller', type: 'permanent', firstLogin: true }, // Exemplo de usu√°rio de venda que ter√° que trocar
        'maikhonven':  { password: 'mai' + currentYear, role: 'seller', type: 'permanent', firstLogin: true },
        'ryanven':     { password: 'rya' + currentYear, role: 'seller', type: 'permanent', firstLogin: true },
    };
    // SENHA CONFIDENCIAL AGORA DEFINIDA AQUI E N√ÉO NO HTML
    const CONFIDENTIAL_CODE = '@0639'; 

    // ATEN√á√ÉO: PRODUCTS reestruturado para o novo modelo de 'sources'
    let PRODUCTS = [ 
        { id: 1, name: 'DJI Neo Standard', spec: 'üõ∏ DJI Neo Standard ou Combo fly more\nüé• Grava em 4K/30fps\n‚è±Ô∏è At√© 18 minutos de voo\nüì° Alcance de at√© 6 km\n‚öñÔ∏è Peso de apenas 135 g\nüéÆ Controle via app, com controle ou controle motion ( tr√™s vers√µes)', salePrice: 1900, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1340 }] },
        { id: 2, name: 'DJI Neo Combo', spec: 'üõ∏ DJI Neo Standard ou Combo fly more\nüé• Grava em 4K/30fps\n‚è±Ô∏è At√© 18 minutos de voo\nüì° Alcance de at√© 6 km\n‚öñÔ∏è Peso de apenas 135 g\nüéÆ Controle via app, com controle ou controle motion ( tr√™s vers√µes)', salePrice: 3500, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2460 }] },
        { id: 3, name: 'DJI Mini 3 (sem tela)', spec: 'üõ∏ DJI Mini 3\nüé• Grava em 4K HDR a 30fps\n‚è±Ô∏è At√© 38 minutos de voo\nüì° Dist√¢ncia de at√© 18 km\n‚öñÔ∏è Peso leve: 249 g\nüéÆ Controle com ou sem tela (duas vers√µes)', salePrice: 3990, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2990 }] },
        { id: 4, name: 'DJI Mini 3 (com tela)', spec: 'üõ∏ DJI Mini 3\nüé• Grava em 4K HDR a 30fps\n‚è±Ô∏è At√© 38 minutos de voo\nüì° Dist√¢ncia de at√© 18 km\n‚öñÔ∏è Peso leve: 249 g\nüéÆ Controle com ou sem tela (duas vers√µes)', salePrice: 4785, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 3785 }] },
        { id: 5, name: 'DJI Flip Fly More Combo (com tela)', spec: 'üõ∏ DJI Flip\nüé• 4K a 60fps (com slow motion de at√© 100fps!)\n‚è±Ô∏è At√© 31 minutos no ar\nüì° Alcance m√©dio de 13 km\n‚öñÔ∏è Menos de 249 g\nüéÆ Dispon√≠vel com ou sem controle com tela', salePrice: 7990, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 5320 }] },
        { id: 64, name: 'DJI Mini 4 Pro Fly More Combo Plus (com tela)', spec: 'üõ∏ DJI Mini 4 Pro\nüé• Incr√≠vel 4K HDR a 100fps + fotos de 48 MP\n‚è±Ô∏è At√© 45 minutos no air\nüì° Alcance de at√© 25 km\n‚öñÔ∏è Abaixo de 249 g\nüéÆ Controle com tela (DJI RC 2)', salePrice: 9000.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 6990.00 }] },
        { id: 67, name: 'DJI Avata 2 Fly More Combo (1 bateria)', spec: 'üõ∏ DJI Avata 2\nüé• Grava√ß√£o 4K 60fps com lente ultrawide\n‚è±Ô∏è At√© 23 minutos de voo imersivo\nüì° Alcance de at√© 13 km\n‚öñÔ∏è Peso de 377 g\nüéÆ Controle por movimento + √≥culos FPV (sem tela)', salePrice: 10590.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 7069.91 }] },
        { id: 68, name: 'DJI Avata 2 Fly More Combo (3 baterias)', spec: 'üõ∏ DJI Avata 2\nüé• Grava√ß√£o 4K 60fps com lente ultrawide\n‚è±Ô∏è At√© 23 minutos de voo imersivo\nüì° Alcance de at√© 13 km\n‚öñÔ∏è Peso de 377 g\nüéÆ Controle por movimento + √≥culos FPV (sem tela)', salePrice: 12990.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 8674.53 }] },
        { id: 65, name: 'DJI Air 3S Standard (sem tela)', spec: 'üõ∏ DJI Air 3S (Vers√£o Standard)\nüé• 4K 60fps com sensores duplos (wide + tele)\n‚è±Ô∏è At√© 45 minutos no ar\nüì° Alcance insano de 32 km\n‚öñÔ∏è Peso de 724 g\nüéÆ Controle sem tela (standard)', salePrice: 12790.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 8532.92 }] },
        { id: 72, name: 'DJI Mavic 4 Pro Combo (com tela)', spec: 'üöÄ DJI Mavic 4 Pro\nüé• 5.1K a 120fps com sensor 4/3 CMOS\n‚è±Ô∏è At√© 46 minutos de voo\nüì° Alcance de at√© 32 km\n‚öñÔ∏è 958 g\nüéÆ Controle com tela (DJI RC Pro)', salePrice: 26670.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 19920.00 }] },
        { id: 71, name: 'DJI Mavic 4 Pro Creator Combo (HDMI, 512GB)', spec: 'üöÄ DJI Mavic 4 Pro Creator Combo\nMesmo conjunto do Mavic 4 Pro com:\nüéí Acess√≥rios profissionais\nüîã Baterias extras e hub inteligente\nüß≥ Maleta refor√ßada para transporte\nüéÆ Controle com tela (DJI RC Pro 2)', salePrice: 35650.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 26650.00 }] },
        { id: 39, name: 'DJI Mavic 3 Multispectral', spec: 'üå± DJI Mavic 3 Multispectral (Vers√£o Standard)\nüé• C√¢mera RGB 20 MP + 4 sensores multispectrais\n‚è±Ô∏è At√© 43 minutos por voo\nüì° Alcance de 15 km\n‚öñÔ∏è 951 g\nüéÆ Controle com tela (DJI RC Pro Enterprise)\nüß™ Ideal para agricultura de precis√£o e NDVI', salePrice: 43970, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 32990.00 }] },
        { id: 40, name: 'DJI Mavic 3 Thermal', spec: 'üî• DJI Mavic 3 Thermal (Vers√£o Standard)\nüé• 4K + c√¢mera t√©rmica 640x512 px\n‚è±Ô∏è At√© 45 minutos por voo\nüì° Alcance de 15 km\n‚öñÔ∏è 920 g\nüéÆ Controle com tela (DJI RC Pro Enterprise)\nüî• Ideal para inspe√ß√£o, resgate e seguran√ßa', salePrice: 41700, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 31990.00 }] },
        { id: 41, name: 'DJI Mavic 3 Enterprise', spec: 'üó∫Ô∏è DJI Mavic 3 Enterprise (Vers√£o Standard)\nüé• C√¢mera RGB 20 MP com obturador mec√¢nico\nüó∫Ô∏è Compat√≠vel com RTK, alto-falante e holofote\n‚è±Ô∏è At√© 45 minutos de voo\nüì° Alcance de 15 km\n‚öñÔ∏è 915 g\nüéÆ Controle com tela (DJI RC Pro Enterprise)\nüìê Indicado para mapeamentos e medi√ß√µes t√©cnicas', salePrice: 31270, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 23990.00 }] },
        { id: 42, name: 'DJI Matrice 4T', spec: 'üõ†Ô∏è DJI Matrice 4T (Vers√£o Standard)\nüé• RGB 48 MP + Zoom h√≠brido 56x + C√¢mera t√©rmica de alta resolu√ß√£o\nüß≠ Vis√£o tripla: Wide, Zoom e T√©rmica\n‚è±Ô∏è At√© 55 minutos por voo\nüì° Alcance de at√© 20 km\n‚öñÔ∏è Peso: 3,7 kg\nüéÆ Controle DJI RC Plus com tela de 7‚Äù ultra brilhante\nüíº IP55 ‚Äì Ideal para resgate, combate a inc√™ndio e inspe√ß√µes', salePrice: 61990, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 45302.65 }] },
        { id: 43, name: 'DJI Matrice 4E', spec: 'üõ†Ô∏è DJI Matrice 4E (Vers√£o Standard)\nüé• C√¢mera ampla de 20 MP com obturador mec√¢nico\nüß≠ Suporte a RTK, payloads e expans√µes avan√ßadas\n‚è±Ô∏è At√© 55 minutos de voo\nüì° Alcance de at√© 20 km\n‚öñÔ∏è Peso: 3,4 kg\nüéÆ Controle DJI RC Plus\nüîß Ideal para mapeamento, seguran√ßa e vigil√¢ncia industrial', salePrice: 58589.97, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 43112.98 }] },
        { id: 113, name: 'DJI Matrice 30T', spec: 'üõ†Ô∏è DJI Matrice 30T (Vers√£o Standard)\nüé• C√¢mera Wide 48 MP + Zoom H√≠brido + C√¢mera T√©rmica\n‚è±Ô∏è At√© 41 minutos por voo\nüì° Alcance de at√© 15 km\n‚öñÔ∏è Peso: 3,77 kg\nüéÆ Controle DJI RC Plus com tela de 7‚Äù\nüíº Prote√ß√£o IP55 ‚Äì Ideal para opera√ß√µes em campo aberto', salePrice: 0, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 0 }] },
        { id: 114, name: 'DJI Matrice 350 RTK', spec: 'üõ†Ô∏è DJI Matrice 350 RTK (Vers√£o Standard)\nüé• Compat√≠vel com payloads L2, P1, H30T e sensores externos\nüß≠ RTK integrado para mapeamento de alta precis√£o\n‚è±Ô∏è At√© 55 minutos de voo\nüì° Alcance de at√© 20 km\n‚öñÔ∏è Peso m√©dio de 3,8 kg sem carga\nüéÆ Controle DJI RC Plus com tela de 7‚Äù\nüíº Estrutura refor√ßada com prote√ß√£o IP55', salePrice: 0, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 0 }] },
        { id: 44, name: 'GOHOBBY SENTINEL', spec: 'üõ°Ô∏è GOHOBBY Sentinel\nUm sistema passivo de detec√ß√£o, sem interfer√™ncias, ideal para monitoramento discreto:\nüì° Frequ√™ncias: 2.4 GHz, 5.1 GHz, 5.8 GHz\nüõ©Ô∏è Protocolos suportados: DJI (O1‚ÄìO4), Autel, eWiFi, PAL, NTSC, LightBridge, Datalink\nüìç Alcance de detec√ß√£o: at√© 5 km\nüîÅ Detec√ß√£o simult√¢nea: at√© 10 drones\n‚è±Ô∏è Tempo de localiza√ß√£o: ‚â§ 3 s\nüïí Autonomia da bateria: at√© 12 h\nüéØ Precis√£o de localiza√ß√£o: ‚â§ 3 m\nüíª Tela: 6.3‚Äù touchscreen\nüåê Conectividade: Wi‚ÄëFi e LTE\n‚öñÔ∏è Peso: 0,65 kg + bateria externa (~0,6 kg)\n‚öôÔ∏è IP: IP54', salePrice: 135990, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 108590.00 }] },
        { id: 45, name: 'SKYFEND HUNTER', spec: 'üå©Ô∏è Skyfend Hunter (AFA100)\nUm jammer port√°til com detec√ß√£o e contra-a√ß√£o integrada, t√≠pico ‚Äúgun‚Äù:\nüì° Detec√ß√£o omnidirecional: at√© 2 km\nüö´ Jamming direcional: at√© 3 km\nüì∂ Cobertura de frequ√™ncia: 400 MHz‚Äì6 GHz (RF + GNSS: GPS, Glonass, Beidou, Galileo)\n‚è±Ô∏è Autonomia: at√© 8 h em espera e 1 h com jamming ativo\nüïå Tela: touchscreen 3,5‚Äù\nüîÑ Adaptabilidade: adapta√ß√£o autom√°tica de frequ√™ncia\n‚öôÔ∏è IP: IP65\n‚öñÔ∏è Peso: aprox. 6,5 kg', salePrice: 379749, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 265822.10 }] },
        { id: 46, name: 'SKYFEND BLADER', spec: '‚ö° Skyfend Blader\nUm jammer port√°til de alta pot√™ncia, enxuto e focado na neutraliza√ß√£o:\nüåê Alcance de jamming: at√© 1,5 km\nüì∂ Cobertura de frequ√™ncia: 868 MHz, 915 MHz, 1.2 GHz, 1.4 GHz, 1.6 GHz, 2.4 GHz, 4.95 GHz, 5.2‚Äì5.8 GHz\n‚è±Ô∏è Jamming ativado: at√© 30 min\nüß≠ Dire√ß√£o e campo de vis√£o: azimute ¬±15¬∞, pitch ¬±10¬∞\n‚öñÔ∏è Peso: ‚âà 4 kg\n‚öôÔ∏è IP: IP65', salePrice: 147898.28, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 106328.80 }] },
        { id: 31, name: 'C√¢mera DJI Osmo Pocket 3 Standard', spec: 'üì∑ DJI Osmo Pocket 3 Standard\nüé• Grava√ß√£o em 4K com sensor grande\nüì± Tela articulada touchscreen\nüîÅ Gimbal mec√¢nico de 3 eixos\nüí° Ideal para criadores que filmam em movimento\nüîã Autonomia de at√© 120 minutos\nüì¶ Compacta e leve: cabe no bolso', salePrice: 6990, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 4658.47 }] },
        { id: 92, name: 'C√¢mera DJI Osmo Action 4 Adventure Combo', spec: 'üì∑ DJI Osmo Action 4 Adventure Combo\nüé• V√≠deos em 4K HDR a 120 fps\nüåä √Ä prova d‚Äôagua at√© 18 metros (sem case)\nüîã Inclui 2 baterias extras + suporte de carregamento\nüì± Controle via app DJI Mimo\nüì¶ Pensada para esportes e ambientes extremos', salePrice: 4790.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 3194.13 }] },
        { id: 94, name: 'C√¢mera DJI Osmo Action 4 Standard Combo', spec: 'üì∑ DJI Osmo Action 4 Standard Combo\nüé• 4K ultra amplo com estabiliza√ß√£o RockSteady\nüéØ Lente grande angular com excelente capta√ß√£o de luz\nüì± Integra√ß√£o total com o app DJI\nüß≥ Compacta, ideal para vloggers e aventureiros iniciantes', salePrice: 3490.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 2400.00 }] },
        { id: 93, name: 'C√¢mera DJI Osmo Action 5 Pro Standard Combo', spec: 'üì∑ DJI Osmo Action 5 Pro Standard Combo\nüé• 4K a 120 fps com sensor aprimorado para pouca luz\nüåÄ Estabiliza√ß√£o RockSteady 3.0 + HorizonSteady\nüîã Bateria de longa dura√ß√£o com carregamento r√°pido\nüéß √Åudio com 3 microfones e cancelamento de ru√≠do\nüì¶ Perfeita para profissionais e criadores exigentes', salePrice: 4490.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 2992.69 }] },
        { id: 97, name: 'Estabilizador DJI Osmo Mobile 7P', spec: 'üéÆ DJI Osmo Mobile 7P BR\nüì± Compat√≠vel com celulares grandes\nüåÄ Modos de acompanhamento e gestos\nüîã Bateria para at√© 10h de uso', salePrice: 2090.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1396.50 }] },
        { id: 96, name: 'Estabilizador DJI Osmo Mobile 7', spec: 'üéÆ DJI Osmo Mobile 7 BR\nüì± Novo sistema de equil√≠brio autom√°tico\nüîã Leve, com autonomia prolongada\nüß† Integra√ß√£o nativa com app DJI', salePrice: 1249.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 835.23 }] },
        { id: 99, name: 'Estabilizador DJI Osmo Mobile 6', spec: 'üéÆ DJI Osmo Mobile 6 (Cinza Escuro ou Platinum)\nüîã 6h de uso, com ActiveTrack 5.0\nüì± Compacto e retr√°til\nüß≤ Design magn√©tico para montagem r√°pida', salePrice: 1390.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 930.10 }] },
        { id: 95, name: 'Estabilizador DJI Osmo Mobile SE', spec: 'üéÆ DJI Osmo Mobile SE\nüì± Vers√£o acess√≠vel e eficiente\nüéØ Boa estabilidade para v√≠deos casuais\nüß≥ Ideal para iniciantes', salePrice: 990.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 663.49 }] },
        { id: 33, name: 'Estabilizador DJI RS 3 Pro Combo', spec: 'üéÆ DJI RS 3 Pro Combo\nüé• Suporte para c√¢meras profissionais at√© 4,5 kg\nüß† LIDAR focagem + ActiveTrack Pro\nüîã At√© 12h de uso com bateria BG30', salePrice: 7990, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 5790.00 }] },
        { id: 35, name: 'Estabilizador DJI RS 4 Pro Combo', spec: 'üéÆ DJI RS 4 Pro Combo\nüé• Suporte avan√ßado para rigs pesados\nüì° Conectividade profissional\nüîã Bateria BG70 de alta dura√ß√£o', salePrice: 12790, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 8900.00 }] },
        { id: 34, name: 'Estabilizador DJI RS 4 Mini', spec: 'üéÆ DJI RS 4 Mini\nüé• C√¢meras at√© 2 kg\nüîß Ultra leve, com bra√ßo de rota√ß√£o larga\nüîã At√© 10h com autonomia', salePrice: 3890, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2840.00 }] },
        { id: 32, name: 'Estabilizador DJI RS 3 Mini', spec: 'üéÆ DJI RS 3 Mini\nüé• Ideal para c√¢meras mirrorless\nüì¶ Compacto e balanceado\nüîã 10h de bateria', salePrice: 2690, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2335.00 }] },
        { id: 18, name: 'Controle DJI Motion 3', spec: 'üéÆ DJI Motion 3\nüñêÔ∏è Controle por movimento\nüéÆ Compat√≠vel com DJI Neo, Avata 2 e Air 3\nüì° Transmiss√£o precisa + experi√™ncia imersiva', salePrice: 1099, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 734.09 }] },
        { id: 19, name: 'Controle DJI RC', spec: 'üéÆ DJI RC\nüì± Suporte para smartphone\nüì° Alcance at√© 10 km\n‚öñÔ∏è Design leve e ergon√¥mico', salePrice: 3290, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2195.65 }] },
        { id: 20, name: 'Controle DJI RC 2', spec: 'üéÆ DJI RC 2\nüì∫ Tela HD integrada\nüì° Alcance de at√© 20 km\nüîã Autonomia de 4h', salePrice: 3590, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 2395.43 }] },
        { id: 21, name: 'Controle DJI RC Pro (HDMI)', spec: 'üéÆ DJI RC Pro (HDMI)\nüé• Sa√≠da HDMI e sistema Android\nüì° Ultra responsivo com controle DJI Fly\nüì∫ Tela de alto brilho com 1000 nits', salePrice: 10990, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 7330.69 }] },
        { id: 100, name: 'Microfone DJI Mic 2 (2 TX + 1 RX + Case)', spec: 'üé§ DJI Mic 2 (2 transmissores + 1 receptor + case)\nüéß √Åudio est√©reo digital de alt√≠ssima fidelidade (24-bit)\nüîã Grava√ß√£o interna com backup autom√°tico\nüì° Alcance de at√© 250 metros em √°rea aberto\nüß≥ Case com recarga r√°pida e transporte seguro\nüîó Compat√≠vel com c√¢meras DSLR, celulares e computadores', salePrice: 4090.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 2731.69 }] },
        { id: 36, name: 'Microfone DJI Mic Mini (1 TX + 1 RX)', spec: 'üé§ DJI Mic Mini (1 transmissor + 1 receptor)\nüéß Super compacto e leve ‚Äì ideal para creators\nüîã Autonomia de at√© 6 horas por unidade\nüì¶ Sem case de recarga ‚Äì pr√°tico para uso imediato\nüéØ Plug and play com portas USB-C e Lightning', salePrice: 859, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 523.29 }] },
        { id: 37, name: 'Microfone DJI Mic Mini (2 TX + 1 RX + Case)', spec: 'üé§ DJI Mic Mini (2 transmissores + 1 receptor + case)\nüéß Grava√ß√£o est√©reo dupla com sincroniza√ß√£o inteligente\nüîã Case de transporte com recarga autom√°tica\nüì° Conex√£o simult√¢nea com dispositivos duplos\nüì± Perfeito para entrevistas, podcasts e v√≠deos de equipe.', salePrice: 1590, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1062.43 }] },
        { id: 115, name: 'Bateria DJI Neo', spec: 'üîã Bateria DJI Neo\n‚è±Ô∏è Autonomia de at√© 18 minutos por carga\n‚ö° Tecnologia LiPo com prote√ß√£o inteligente\nüîå Recarga via hub ou carregador USB-C\nüì¶ Compat√≠vel exclusivamente com o DJI Neo', salePrice: 0, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 0 }] },
        { id: 12, name: 'Bateria DJI Avata', spec: 'üîã Bateria DJI Avata\n‚è±Ô∏è Cerca de 18 minutos de voo FPV\nüéÆ Ideal para uso com goggles e motion controller\n‚ö° Prote√ß√£o contra curto, descarga e superaquecimento\nüì¶ Peso m√©dio: 162 g', salePrice: 1489, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 994.06 }] },
        { id: 13, name: 'Bateria DJI Avata 2', spec: 'üîã Bateria DJI Avata 2\n‚è±Ô∏è Aproximadamente 23 minutos de voo imersivo\nüì° Otimizada para voos com DJI Goggles 3\n‚ö° Equil√≠brio entre leveza e performance\nüì¶ Recarreg√°vel via hub dedicado', salePrice: 1149, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 767.21 }] },
        { id: 104, name: 'Bateria Mini 3 Pro / 4 Pro', spec: 'üîã Bateria DJI Mini 3 / Mini 4 Pro (Standard)\n‚è±Ô∏è At√© 34 minutos de voo\n‚ö° Compacta, com sensores de seguran√ßa\nüîã Indicador de carga inteligente\nüì¶ Peso m√©dio: 80 g', salePrice: 749.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 570.00 }] },
        { id: 105, name: 'Bateria Mini 3 Pro Plus', spec: 'üîã Bateria DJI Plus Mini 3 / Mini 4 Pro (Alta Capacidade)\n‚è±Ô∏è At√© 45 minutos por carga\n‚ö° Ideal para voos longos e grava√ß√µes cont√≠nuas\nüîã Compat√≠vel com DJI Fly ‚Äì modo ‚Äúmax performance‚Äù\nüì¶ Leve e resistente', salePrice: 1190.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 825.00 }] },
        { id: 15, name: 'Bateria DJI Air 3S / Air 3', spec: 'üîã Bateria DJI Air 3S / Air 3\n‚è±Ô∏è At√© 45 minutos por carga\n‚ö° C√©lulas de alta densidade e vida √∫til prolongada\nüì¶ Compat√≠vel com modo de prioriza√ß√£o de carga via hub\nüîã Recarga otimizada via carregador 100W', salePrice: 1890, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 1261.94 }] },
        { id: 82, name: 'Bateria DJI Mini 2 / SE / 2 SE / 4K', spec: 'üîã Bateria DJI Mini 2 / SE / 2 SE / 4K\n‚è±Ô∏è Entre 22 e 31 minutos de voo (varia conforme o modelo)\n‚ö° Bateria compacta, est√°vel e eficiente\nüì¶ Ideal para pilotos iniciantes ou voos recreativos\nüîã Recarreg√°vel via hub Mini 2', salePrice: 649.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 433.38 }] },
        { id: 83, name: 'Bateria TB51 DJI Inspire 3', spec: 'üîã Bateria TB51 (Inspire 3)\n‚è±Ô∏è Performance profissional com tempo estendido de voo\nüì¶ Sistema avan√ßado de aquecimento autom√°tico\n‚ö° Compat√≠vel com esta√ß√£o de carga DJI BS51\nüîã Controle inteligente de ciclo e temperatura', salePrice: 3999.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 2669.76 }] },
        { id: 81, name: 'Bateria de alta capacidade DJI RS BG70', spec: 'üîã Bateria DJI RS BG70 (para RS 4 Pro)\n‚è±Ô∏è At√© 12 horas de autonomia cont√≠nua\n‚öôÔ∏è Fixa√ß√£o direta no estabilizador RS 4 Pro\nüì¶ Indicador de status em tempo real\nüîã Recarga via conector magn√©tico de alta voltagem', salePrice: 1490.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 996.07 }] },
        { id: 79, name: 'Protetores de H√©lices DJI Neo', spec: 'üõ°Ô∏è Protetores de H√©lice DJI Neo\n‚öôÔ∏è Leves, seguros e ideais para indoor', salePrice: 119.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 100.00 }] },
        { id: 78, name: 'Protetores de H√©lices DJI Mini 3', spec: 'üõ°Ô∏è Protetores de H√©lice DJI Mini 3\n‚öôÔ∏è Encaixe r√°pido, protege h√©lices em espa√ßos apertados', salePrice: 379.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 285.00 }] },
        { id: 77, name: 'H√©lices DJI Neo ‚Äì 2 Pares', spec: 'üåÄ H√©lices DJI Neo ‚Äì 2 Pares', salePrice: 79.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 53.06 }] },
        { id: 75, name: 'H√©lices DJI Flip ‚Äì 2 Pares', spec: 'üåÄ H√©lices DJI Flip ‚Äì 2 Pares', salePrice: 104.90, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 70.31 }] },
        { id: 73, name: 'H√©lices DJI Mini 2/SE/2 SE/4K ‚Äì 2 Pares', spec: 'üåÄ H√©lices DJI Mini 2/SE/2 SE/4K ‚Äì 2 Pares', salePrice: 119.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 53.06 }] },
        { id: 76, name: 'H√©lices DJI Inspire 3 ‚Äì Par', spec: 'üåÄ H√©lices DJI Inspire 3 ‚Äì Par', salePrice: 499.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 391.91 }] },
        { id: 74, name: 'H√©lices DJI Avata 2 ‚Äì 2 Pares', spec: 'üåÄ H√©lices DJI Avata 2 ‚Äì 2 Pares', salePrice: 109.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 70.31 }] },
        { id: 38, name: 'DJI Goggles 3', spec: 'üëì DJI Goggles 3\nüì∫ Duas telas OLED 1080p de alta nitidez\nüß† Sistema de head tracking imersivo com baixa lat√™ncia\nüîã Bateria interna com at√© 3 horas de autonomia\nüì° Transmiss√£o O4 compat√≠vel com Avata 2, Mini 4 Pro,  Air 3 e Neo\nüß≥ Ajuste ergon√¥mico para conforto prolongado', salePrice: 6490, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 4327.89 }] },
        { id: 88, name: 'DJI Goggles N3', spec: 'üëì DJI Goggles N3\nüì∫ Compat√≠veis com o DJI Neo e Motion Controller 3\nüîã Bateria interna com at√© 2 horas de uso cont√≠nuo\nüåÄ Imers√£o FPV com m√≠nima lat√™ncia\nüì¶ Design leve e dobr√°vel, ideal para transporte', salePrice: 2990.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 1999.56 }] },
        { id: 25, name: 'Hub de Carregamento DJI Avata 2', spec: 'üîÅ Hub de Carregamento DJI Avata 2\nüîã Sistema inteligente de carregamento e equaliza√ß√£o\n‚ö° Alta efici√™ncia t√©rmica\nüîå Compat√≠vel com powerbanks USB-C PD\nüì¶ Ideal para voos FPV com m√∫ltiplas baterias', salePrice: 499, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 333.62 }] },
        { id: 26, name: 'Hub de Carregamento DJI Neo', spec: 'üîÅ Hub de Carregamento DJI Neo\nüîã Carga sequencial de at√© 3 baterias\n‚ö° Tempo m√©dio por unidade: 75 minutos\nüîå Compat√≠vel com carregadores 65W DJI\nüì¶ Leve, port√°til e de encaixe r√°pido', salePrice: 419, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 280.00 }] },
        { id: 27, name: 'Hub de Carregamento DJI Mini 3 / 3 Pro / 4 Pro', spec: 'üîÅ Hub de Carregamento DJI Mini 3 / 3 Pro / 4 Pro\nüîã At√© 3 baterias com transfer√™ncia de carga\n‚ö° Balanceamento autom√°tico\nüì¶ Ideal para opera√ß√£o em campo', salePrice: 519, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 347.01 }] },
        { id: 28, name: 'Hub de Carregamento DJI Air 3 / Air 3S', spec: 'üîÅ Hub de Carregamento DJI Air 3 / Air 3S\nüîã Gest√£o autom√°tica da ordem de carga\n‚ö° Suporte a carregamento paralelo\nüì± Status vis√≠vel via app DJI Fly\nüì¶ Compacto com LEDs indicadores', salePrice: 799, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 500.09 }] },
        { id: 29, name: 'Carregador USB-C DJI 100W', spec: '‚ö° Carregador USB-C DJI 100W\nüîå Carga dupla simult√¢nea (hub + controle)\n‚ö° Reconhecimento inteligente de voltagem\n‚è±Ô∏è Carga total entre 60 e 90 min por bateria\nüì± Compat√≠vel com outros dispositivos USB-C', salePrice: 619, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 415.23 }] },
        { id: 30, name: 'Carregador USB-C DJI 65W', spec: '‚ö° Carregador USB-C DJI 65W\nüîã Leve e vers√°til\n‚ö° Ideal para controles e baterias padr√£o DJI\nüì¶ Prote√ß√£o contra sobrecarga e superaquecimento\nüß≥ Perfeito para uso port√°til', salePrice: 389, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 573.86 }] },
        { id: 16, name: 'Esta√ß√£o de Energia DJI Power 1000', spec: 'üîå DJI Power 1000\n‚ö° Pot√™ncia total: 1000W\nüîã Bateria interna de longa dura√ß√£o (1024 Wh)\nüîå Diversas sa√≠das: USB-C, AC, DC e carregamento solar\nüì¶ Ideal para opera√ß√µes em campo, emerg√™ncias e drones de grande porte\nüß≥ Design robusto, com al√ßa retr√°til e tela inteligente', salePrice: 9590, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 6314.47 }] },
        { id: 17, name: 'Esta√ß√£o de Energia DJI Power 500', spec: 'üîå DJI Power 500\n‚ö° Pot√™ncia total: 500W\nüîã Capacidade de 512 Wh\nüîå Entradas e sa√≠das para m√∫ltiplos dispositivos simult√¢neos\nüì¶ Port√°til e eficiente para filmagens externas, inspe√ß√µes ou backup em locais remotos\nüß≥ Compacta e f√°cil de transportar', salePrice: 6190, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 4071.35 }] },
        { id: 80, name: 'Sistema DJI Focus Pro ‚Äì All-In-One Combo', spec: 'üéØ Sistema DJI Focus Pro ‚Äì All-In-One Combo\nüé• Foco autom√°tico inteligente para c√¢meras profissionais\nüì° Controle remoto de alta precis√£o com delay ultrabaixo\nüîã Motor silencioso com bateria integrada de longa dura√ß√£o\n‚öôÔ∏è Compat√≠vel com estabilizadores da linha RS e c√¢meras DSLR/cinema\nüß† Modos: foco manual, autom√°tico e via reconhecimento facial\nüì¶ Inclui motor, controle, cabo de dados e acess√≥rios profissionais\nüß≥ Ideal para produ√ß√µes de alto n√≠vel, cinema, comerciais e conte√∫do t√©cnico', salePrice: 16990.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 11133.54 }] },
        { id: 86, name: 'Sistema DJI SDR Transmission Combo', spec: 'üì∂ Sistema DJI SDR Transmission Combo\nüì° Transmiss√£o de v√≠deo em tempo real com ultra baixa lat√™ncia\nüì∫ Entrada HDMI para c√¢meras externas (profissionais ou drone FPV customizado)\nüì± Compat√≠vel com smartphones ou tablets via suportes dedicados\nüîå Alimenta√ß√£o via bateria integrada ou ou fonte externa\nüéØ Ideal para transmiss√µes ao vivo, monitoramento t√©cnico ou grava√ß√µes de precis√£o\nüì¶ Combo inclui receptor SDR, cabos, suporte de fixa√ß√£o e encaixes ajust√°veis', salePrice: 5990.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 4004.27 }] },
        { id: 84, name: 'Suporte de Telefone SDR', spec: 'üì± Suporte de Telefone SDR\nüß≤ Suporte magn√©tico com ajuste de √¢ngulo e altura\nüì¶ Compat√≠vel com celulares de at√© 7‚Äù', salePrice: 579.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 257.45 }] },
        { id: 85, name: 'Suporte de Tablet SDR', spec: 'üíª Suporte de Tablet SDR\nüìê Estrutura expandida para tablets de at√© 10‚Äù\n‚öôÔ∏è Base firme com regulagem personalizada\nüß≥ Ideal para visualiza√ß√£o ampla em campo', salePrice: 579.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 500.09 }] },
        { id: 89, name: 'Hard Case Mavic Air 2 / Air 2S', spec: 'üéí Hard Case Mavic Air 2 / Air 2S\nüíº Prote√ß√£o r√≠gida + interior espumado', salePrice: 599.00, 
            sources: [{ supplierName: 'Arroba Celulares', costPrice: 339.72 }] },
        { id: 90, name: 'Kit Apoio DJI RC Plus', spec: 'üéí Kit Apoio DJI RC Plus\nüß≥ Tira de ombro + apoio de cintura\nüéÆ Ideal para longas opera√ß√µes', salePrice: 769.00, 
            sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 140.73 }] },
        { id: 91, name: 'Garrafa DJI 650mL ‚Äì Preto Gradiente', spec: 'ü•§ Garrafa DJI 650mL ‚Äì Preto Gradiente\nüíß Estilo DJI com hidrata√ß√£o', salePrice: 149.00, 
            sources: [{ supplierName: 'DJI Grupo Multi', costPrice: 79.88 }] },
        // Exemplo de produto com M√öLTIPLOS fornecedores
        { id: 1000, name: 'Bateria Universal P-Drone', spec: 'üîã Bateria de alta capacidade universal', salePrice: 1500.00,
            sources: [
                { supplierName: 'Arroba Celulares', costPrice: 1000.00 },
                { supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 950.00 }
            ]
        },
        { id: 1001, name: 'Kit H√©lice Super Resistente (2 Pares)', spec: 'üåÄ H√©lices de fibra de carbono para alta durabilidade.', salePrice: 250.00,
            sources: [
                { supplierName: 'DJI Grupo Multi', costPrice: 150.00 },
                { supplierName: 'Arroba Celulares', costPrice: 160.00 }
            ]
        }
    ];
    const SUPPLIERS = [
        { 
            name: 'Arroba Celulares', 
            details: 'Origem: Goi√¢nia ‚Äì GO<br>Estoque: Arroba', 
            payment: '<strong>Pix:</strong> arrobasafra@gmail.com<br><strong>Banco:</strong> Banco Safra S.A.<br><strong>Empresa:</strong> GRAN E-COMMERCE LTDA',
            products: 'Drones da linha consumer (Neo, Mini 3, Flip), controles, baterias, Osmo, Mic, carregadores, h√©lices e protetores.' 
        },
        { 
            name: 'GoHobby Distribuidora de VANT LTDA', 
            details: 'Origem: S√£o Paulo ‚Äì SP<br>Estoque: GoHobby',
            payment: '<strong>Pix (CNPJ):</strong> 13.373.898/0001-95<br><strong>Banco Ita√∫ (341):</strong> Ag√™ncia: 6327, Conta Corrente: 15310-9',
            products: 'Drones Enterprise (Mavic 3E/T/Multi), Matrice 4, 30 e 350 RTK, Skyfend Hunter, Skyfend Blader, Sentinel + atualiza√ß√£o.'
        },
        { 
            name: 'DJI Grupo Multi', 
            details: 'Origem: S√£o Paulo ‚Äì SP<br>Estoque: Grupo Multi (Distribuidor oficial DJI no Brasil)',
            payment: 'N√£o especificado',
            products: 'Air 3S, Avata 2, Neo combos com Goggles, Flip, c√¢meras Osmo Action e Pocket, estabilizadores, microfones, baterias e acess√≥rios originais.'
        }
    ];
    const INSTALLMENT_RATES = {
        1: 0.0309, 2: 0.0579, 3: 0.0609, 4: 0.0799, 5: 0.0809, 6: 0.0818,
        7: 0.0949, 8: 0.0966, 9: 0.1037, 10: 0.1105, 11: 0.1227, 12: 0.1238
    };

    // --- ELEMENTOS DO HTML (DOM) ---
    const loginScreen = document.getElementById('login-screen');
    const appScreen = document.getElementById('app-screen');
    const loginButton = document.getElementById('login-button');
    const logoutButton = document.getElementById('logout-button');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('login-error');
    const welcomeMessage = document.getElementById('welcome-message');
    const changePasswordLink = document.getElementById('change-password-link'); // NOVO
    const visitorModeButton = document.getElementById('visitor-mode-button'); 

    const navButtons = document.querySelectorAll('.nav-button');
    const contentSections = document.querySelectorAll('.content-section');
    const productsNavButton = document.getElementById('products-nav-button'); 
    const calculatorNavButton = document.getElementById('calculator-nav-button'); 
    const suppliersNavButton = document.getElementById('suppliers-nav-button');
    const settingsNavButton = document.getElementById('settings-nav-button'); 
    const dronesNavButton = document.getElementById('drones-nav-button'); 
    const infoEmpresaNavButton = document.getElementById('info-empresa-nav-button'); 

    // Novos bot√µes de sub-navega√ß√£o em Configura√ß√µes
    const manageUsersNavButton = document.getElementById('manage-users-nav-button');
    const createProductNavButton = document.getElementById('create-product-nav-button');
    const editProductNavButton = document.getElementById('edit-product-nav-button');
    const settingsSubNav = document.getElementById('settings-sub-nav'); 


    const productList = document.getElementById('product-list');
    const supplierList = document.getElementById('supplier-list');
    const productSearchInput = document.getElementById('product-search');
    const droneVisitorList = document.getElementById('drone-visitor-list'); 
    const droneVisitorSearchInput = document.getElementById('drone-visitor-search'); 

    const mainModal = document.getElementById('main-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const closeModalButton = document.querySelector('.close-button');

    // Elementos da se√ß√£o Gerir Usu√°rios
    const createTempUserForm = document.getElementById('create-temp-user-form');
    const tempUserFeedback = document.getElementById('temp-user-feedback');
    const tempUserListContainer = document.getElementById('temp-user-list');

    // Elementos da se√ß√£o Criar Produto
    const createProductForm = document.getElementById('create-product-form');
    const createProductFeedback = document.getElementById('create-product-feedback');

    // Elementos da se√ß√£o Alterar Produto
    const editProductSearchIdInput = document.getElementById('edit-product-search-id');
    const searchProductToEditButton = document.getElementById('search-product-to-edit');
    const editProductDisplay = document.getElementById('edit-product-display');
    const editProductForm = document.getElementById('edit-product-form');
    const editProductIdInput = document.getElementById('edit-product-id');
    const editProductNameInput = document.getElementById('edit-product-name');
    const editProductSpecTextarea = document.getElementById('edit-product-spec');
    const editProductSalePriceInput = document.getElementById('edit-product-sale-price');
    const editProductCostPriceInput = document.getElementById('edit-product-cost-price');
    const editProductSupplierInput = document.getElementById('edit-product-supplier');
    const editProductFeedback = document.getElementById('edit-product-feedback');


    const mainContent = document.getElementById('main-content');
    const scrollToTopButton = document.getElementById('scroll-to-top');

    const generalCalcValorBase = document.getElementById('general-valor-base');
    const generalCalcPaymentRadios = document.querySelectorAll('input[name="general-payment-method"]');
    const generalCalcInstallmentsContainer = document.getElementById('general-installments-container');
    const generalCalcParcelasSelect = document.getElementById('general-parcelas');
    const generalCalculateButton = document.getElementById('general-calculate-button');
    const generalCalculatorResult = document.getElementById('general-calculator-result');

    const navToggleButton = document.getElementById('nav-toggle-btn');
    const navToggleButtonClose = document.getElementById('nav-toggle-btn-close'); 
    const navElement = document.querySelector('nav'); 
    const appBody = document.querySelector('.app-body');
    const headerElement = document.querySelector('header'); 

    const bodyElement = document.body; 

    // Novos elementos da IA
    const aiChatButton = document.getElementById('ai-chat-button');
    const aiChatModal = document.getElementById('ai-chat-modal');
    const aiChatCloseButton = document.getElementById('ai-chat-close-button');
    const aiQuestionInput = document.getElementById('ai-question-input');
    const submitAiQuestionButton = document.getElementById('submit-ai-question');
    const aiResponseArea = document.getElementById('ai-response-area');
    const aiLoader = document.getElementById('ai-loader');

    // NOVO: Elementos do modal de senha do fornecedor
    const supplierPasswordModal = document.getElementById('supplier-password-modal');
    const supplierAccessPasswordInput = document.getElementById('supplier-access-password');
    const submitSupplierPasswordButton = document.getElementById('submit-supplier-password');
    const supplierPasswordError = document.getElementById('supplier-password-error');
    const supplierPasswordCloseButton = document.getElementById('supplier-password-close-button');

    // NOVO: Elementos do modal de altera√ß√£o de senha
    const changePasswordModal = document.getElementById('change-password-modal');
    const changePasswordModalTitle = document.getElementById('change-password-modal-title');
    const changePasswordMessage = document.getElementById('change-password-message');
    const newPasswordInput = document.getElementById('new-password');
    const confirmNewPasswordInput = document.getElementById('confirm-new-password');
    const submitChangePasswordButton = document.getElementById('submit-change-password');
    const changePasswordError = document.getElementById('change-password-error');
    const changePasswordSuccess = document.getElementById('change-password-success');
    const changePasswordCloseButton = document.getElementById('change-password-close-button');


    let currentUser = null;
    let activeSectionId = 'products-section'; // Define a se√ß√£o inicial padr√£o para usu√°rios logados
    let tempUserInterval;
    let pendingSupplierSectionAccess = false; // Flag para controlar o acesso pendente aos fornecedores

    // --- FUN√á√ïES DA API GEMINI ---
    async function callGeminiAPI(prompt, title, isProductHelp = false, productSpecs = '', isGeneralAI = false) { 
        if (!isGeneralAI) {
            modalTitle.textContent = title;
            modalBody.innerHTML = '<div class="loader"></div>';
            openModal(); 
        } else {
            aiChatModal.style.display = 'block';
            aiLoader.style.display = 'block';
            aiResponseArea.style.display = 'none'; 
            aiResponseArea.innerHTML = ''; 
            mainModal.style.display = 'none'; 
        }

        const apiKey = "YOUR_GEMINI_API_KEY"; // <<<<< Substitua pela sua chave Gemini REAL
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`; 
        
        let fullPrompt = prompt;
        if (isProductHelp) {
            fullPrompt = `R2D2: Responda de forma direta e clara (m√°ximo 3 frases) √† seguinte d√∫vida do cliente sobre o produto "${productSpecs}". D√∫vida do cliente: "${prompt}"`;
        } else if (isGeneralAI) { 
            const currentDateTime = new Date().toLocaleString('pt-BR', { dateStyle: 'full', timeStyle: 'long' });
            fullPrompt = `Voc√™ √© um assistente da Galv√£o Drones, especializada em drones e equipamentos DJI. Responda de forma √∫til, amig√°vel e concisa (m√°ximo 4 frases) √†s perguntas, utilizando o conhecimento de um especialista em drones. Se a pergunta for sobre produtos espec√≠ficos da Galv√£o Drones, como modelos de drones ou equipamentos, use seu conhecimento para dar uma resposta detalhada sobre o universo de drones. Se a pergunta for sobre a empresa "Galv√£o Drones" (como localiza√ß√£o, contato, servi√ßos), forne√ßa as seguintes informa√ß√µes: "A Galv√£o Drones est√° localizada na Rua 16, n¬∫ 304 ‚Äì Setor Aerovi√°rio, Goi√¢nia ‚Äì GO, CEP: 74435-240. Voc√™ pode nos contatar pelo telefone (62) 3636-0668 ou pelo WhatsApp 556236360668. Nosso website √© www.galvaodrones.com.br e tamb√©m estamos no Instagram (@galvao_drones) e YouTube (Galv√£o Drones)." Considere a data e hora atual: ${currentDateTime}. Pergunta do usu√°rio: "${prompt}"`;
        } else {
             fullPrompt = `R2D2: ${prompt}`;
        }

        const payload = { contents: [{ role: "user", parts: [{ text: fullPrompt }] }] };
        
        try {
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) {
                 const errorData = await response.json();
                 throw new Error(errorData.error.message || `Erro na API: ${response.statusText}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts) {
                const text = result.candidates[0].content.parts[0].text;
                if (isGeneralAI) {
                    aiResponseArea.innerHTML = text.replace(/\n/g, '<br>');
                    aiResponseArea.style.display = 'block';
                    aiLoader.style.display = 'none';
                } else {
                    modalBody.innerHTML = text.replace(/\n/g, '<br>');
                }
            } else { throw new Error("A resposta da API n√£o cont√©m o conte√∫do esperado."); }
        } catch (error) {
            console.error("Erro ao chamar a API Gemini:", error);
            if (isGeneralAI) {
                aiResponseArea.innerHTML = `<p style="color:red;">Ocorreu um erro ao comunicar com a IA. Tente novamente.<br><small>Detalhe: ${error.message}</small></p>`;
                aiResponseArea.style.display = 'block';
                aiLoader.style.display = 'none';
            } else {
                modalBody.innerHTML = `<p style="color:red;">Ocorreu um erro ao comunicar com a IA. Tente novamente.<br><small>Detalhe: ${error.message}</small></p>`;
            }
        }
    }

    // --- FUN√á√ïES PRINCIPAIS DO APP ---
    function handleLogin() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        const user = USERS[username];

        if (user && user.password === password) {
            if (user.type === 'temporary' && Date.now() > user.expiresAt) {
                loginError.textContent = 'Este usu√°rio tempor√°rio expirou.';
                loginError.style.display = 'block';
                return;
            }
            currentUser = { ...user, username: username }; // Armazena o username do usu√°rio logado

            // NOVO: Verifica se √© o primeiro login e se N√ÉO √© um usu√°rio tempor√°rio
            if (currentUser.firstLogin && currentUser.type !== 'temporary') {
                loginScreen.style.display = 'none';
                appScreen.style.display = 'block'; // Mostra a tela principal
                showChangePasswordModal(true); // true = obrigat√≥rio
            } else {
                loginScreen.style.display = 'none';
                appScreen.style.display = 'block';
                loginError.style.display = 'none';
                setupAppForUser();
            }
        } else {
            loginError.textContent = 'Usu√°rio ou senha inv√°lidos.';
            loginError.style.display = 'block';
        }
    }

    function handleVisitorMode() {
        currentUser = { username: 'Visitante', role: 'visitor', type: 'permanent', firstLogin: false }; // Modo visitante
        loginScreen.style.display = 'none';
        appScreen.style.display = 'block';
        loginError.style.display = 'none';
        setupAppForUser();
    }

    function handleLogout() {
        currentUser = null;
        clearInterval(tempUserInterval);
        appScreen.style.display = 'none';
        loginScreen.style.display = 'block';
        usernameInput.value = '';
        passwordInput.value = '';
        // Limpa a classe de visitante do cabe√ßalho ao sair
        headerElement.classList.remove('visitor-header');
        // Remove a classe do modo visitante do body
        bodyElement.classList.remove('visitor-mode-bg'); 
        // Esconde o bot√£o da IA ao sair
        aiChatButton.style.display = 'none'; 
        aiChatModal.style.display = 'none'; // Garante que o modal da IA tamb√©m feche
        changePasswordLink.style.display = 'none'; // Esconde o link de alterar senha
        // Fecha a nav mobile se estiver aberta
        closeMobileNav();
    }

    function setupAppForUser() {
        const isVisitor = currentUser.isVisitor;
        const isAdmin = currentUser.role === 'admin';
        const isSeller = currentUser.role === 'seller';
        const isTempUser = currentUser.type === 'temporary';
        
        // Resetar visibilidade e ordem da navega√ß√£o
        navButtons.forEach(button => button.classList.add('hidden'));
        settingsSubNav.style.display = 'none'; // Esconde o sub-menu de Configura√ß√µes por padr√£o

        if (isVisitor) {
            welcomeMessage.textContent = 'Modo Visitante';
            headerElement.classList.add('visitor-header'); 
            logoutButton.style.display = 'block'; 
            bodyElement.classList.add('visitor-mode-bg'); 

            dronesNavButton.classList.remove('hidden'); 
            infoEmpresaNavButton.classList.remove('hidden'); 
            dronesNavButton.style.order = 1; 
            infoEmpresaNavButton.style.order = 2; 

            changePasswordLink.style.display = 'none'; // Esconde para visitantes
            switchTab('drones-visitor-section');
        } else { // Logado (Admin ou Seller)
            welcomeMessage.textContent = `Bem-vindo(a), ${currentUser.username}!`;
            headerElement.classList.remove('visitor-header'); 
            logoutButton.style.display = 'block'; 
            bodyElement.classList.remove('visitor-mode-bg'); 

            productsNavButton.classList.remove('hidden');
            calculatorNavButton.classList.remove('hidden');
            dronesNavButton.classList.remove('hidden');
            infoEmpresaNavButton.classList.remove('hidden');

            productsNavButton.style.order = 1;
            calculatorNavButton.style.order = 2;
            dronesNavButton.style.order = 3;
            infoEmpresaNavButton.style.order = 4;

            // NOVO: Exibe o link de alterar senha para usu√°rios logados (n√£o visitantes e n√£o tempor√°rios)
            if (currentUser.type !== 'temporary') {
                 changePasswordLink.style.display = 'inline';
            } else {
                 changePasswordLink.style.display = 'none';
            }
           

            // NOVO: Acesso a se√ß√µes de Admin (Gerir Usu√°rios, Criar/Alterar Produto)
            if (isAdmin) {
                // Acesso a Fornecedores (para admins)
                suppliersNavButton.classList.remove('hidden');
                suppliersNavButton.style.order = 3; // Mant√©m a ordem

                // Se√ß√µes de Configura√ß√µes para Admin
                settingsNavButton.classList.remove('hidden'); // Bot√£o pai de Configura√ß√µes
                settingsNavButton.style.order = 4; // Ordem do bot√£o pai

                // NOVO: Visibilidade das sub-op√ß√µes de configura√ß√µes (apenas para 'mikhaell' em Gerir Usu√°rios)
                if (currentUser.username === 'mikhaell') {
                    manageUsersNavButton.classList.remove('hidden');
                    manageUsersNavButton.style.order = 5;
                } else { // Outros admins n√£o veem gerir usu√°rios
                    manageUsersNavButton.classList.add('hidden');
                }
                
                // Criar e Alterar Produto para todos os admins
                createProductNavButton.classList.remove('hidden');
                editProductNavButton.classList.remove('hidden');
                createProductNavButton.style.order = 6;
                editProductNavButton.style.order = 7;
                
                dronesNavButton.style.order = 8;
                infoEmpresaNavButton.style.order = 9;
            } else { // Se for seller, garante que estas op√ß√µes estejam escondidas
                suppliersNavButton.classList.add('hidden'); // Sellers n√£o veem Fornecedores
                settingsNavButton.classList.add('hidden'); // Sellers n√£o veem Configura√ß√µes
                manageUsersNavButton.classList.add('hidden');
                createProductNavButton.classList.add('hidden');
                editProductNavButton.classList.add('hidden');

                 // Ajusta a ordem para sellers
                productsNavButton.style.order = 1;
                calculatorNavButton.style.order = 2;
                dronesNavButton.style.order = 3;
                infoEmpresaNavButton.style.order = 4;
            }
            
            switchTab('products-section'); // Inicia na se√ß√£o de produtos para logados
        }

        // Exibe/Oculta o bot√£o de Chat da IA (vis√≠vel para todos os logados, incluindo visitantes)
        aiChatButton.style.display = 'block';
        
        // --- CNPJ Display (FIX) ---
        const cnpjDisplayLine = document.getElementById('cnpj-display-line');
        if (cnpjDisplayLine) {
            if (isVisitor) {
                cnpjDisplayLine.style.display = 'none';
            } else {
                cnpjDisplayLine.style.display = 'block';
            }
        }
        // --- FIM CNPJ Display (FIX) ---

        // Configura o bot√£o do menu hamburger/fechar no header
        if (window.innerWidth <= 768) {
            navToggleButton.style.display = 'block'; 
            navToggleButton.textContent = '‚ò∞'; 
            closeMobileNav(); 
        } else {
            navToggleButton.style.display = 'none';
        }
        
        // Se for usu√°rio tempor√°rio, mostra aviso
        if (isTempUser) {
            showTemporaryUserWarning();
        }
    }

    function renderProducts(searchTerm = '') {
        productList.innerHTML = '';
        const lowerCaseSearchTerm = searchTerm.toLowerCase();
        
        if (currentUser.isVisitor) {
            productList.innerHTML = '<p>Funcionalidade de produtos n√£o dispon√≠vel no modo visitante. Use a se√ß√£o "Drones".</p>';
            return;
        }

        const productsToShow = PRODUCTS.filter(p => 
            p.name.toLowerCase().includes(lowerCaseSearchTerm) || 
            p.spec.toLowerCase().includes(lowerCaseSearchTerm) ||
            // NOVO: Busca por fornecedor nos produtos
            (p.sources && p.sources.some(source => source.supplierName.toLowerCase().includes(lowerCaseSearchTerm)))
        );

        if (productsToShow.length === 0) {
            productList.innerHTML = '<p>Nenhum produto encontrado.</p>';
        }

        productsToShow.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'card product-card';
            productCard.dataset.productId = product.id;
            const isAdmin = currentUser.role === 'admin';
            const isSeller = currentUser.role === 'seller';
            
            const salePriceLabel = isSeller ? 'Valor' : 'Valor de Venda';
            
            let adminCostInfoHTML = '';
            if (isAdmin) { 
                adminCostInfoHTML = `<p><strong>Custos por Fornecedor:</strong></p><ul class="product-suppliers-list">`;
                if (product.sources && product.sources.length > 0) {
                    product.sources.forEach(source => {
                        adminCostInfoHTML += `
                            <li>
                                <a href="#" class="supplier-name-link" data-supplier-name="${source.supplierName}">
                                    ${source.supplierName}
                                </a>
                                <span class="cost-value">${source.costPrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>
                            </li>
                        `;
                    });
                } else {
                    adminCostInfoHTML += `<li><span class="cost-value">N/A (Sem Fornecedor Registrado)</span></li>`;
                }
                adminCostInfoHTML += `</ul>`;
            }

            productCard.innerHTML = `
                <h3>${product.name}</h3>
                <p class="product-spec"><strong>Especifica√ß√µes:</strong><br>${product.spec}</p>
                <p class="price">${salePriceLabel}: ${product.salePrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>
                ${isAdmin ? adminCostInfoHTML : ''}
                <div class="action-buttons-container">
                    <button class="gemini-button desc-button">‚ú® Gerar Descri√ß√£o</button>
                    <button class="gemini-button args-button">‚ú® Criar Argumentos</button>
                    <button class="whatsapp-button" data-product-name="${product.name}" data-product-spec="${product.spec}">üí¨ WhatsApp</button>
                    <button class="help-button">üí° Ajudar Cliente</button>
                </div>
                <div class="calculator-container">
                    <div class="payment-method-selector">
                        <input type="radio" id="payment-vista-${product.id}" name="payment-method-${product.id}" value="vista" checked>
                        <label for="payment-vista-${product.id}">√Ä vista</label>
                        <input type="radio" id="payment-parcelado-${product.id}" name="payment-method-${product.id}" value="parcelado">
                        <label for="payment-parcelado-${product.id}">Parcelado</label>
                    </div>
                    ${isAdmin ? `
                    <div class="discount-option hidden" id="discount-option-${product.id}">
                        <label for="discount-percentage-${product.id}">Desconto (%):</label>
                        <input type="number" id="discount-percentage-${product.id}" min="0" max="15" value="0">
                    </div>
                    ` : ''}
                    <div class="installments-container hidden">
                        <label for="parcelas-${product.id}">Parcelas:</label>
                        <select class="parcelas-select">
                           <option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="5">5x</option><option value="6">6x</option><option value="7">7x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option><option value="11">11x</option><option value="12">12x</option>
                        </select>
                    </div>
                    <button class="calculate-product-btn">Calcular</button>
                    <div class="product-calculator-result"></div>
                </div>
            `;
            productList.appendChild(productCard);
        });
    }

    function renderDroneVisitorList(searchTerm = '') {
        droneVisitorList.innerHTML = '';
        const lowerCaseSearchTerm = searchTerm.toLowerCase();
        const dronesToShow = PRODUCTS.filter(p => 
            (p.name.toLowerCase().includes("dji") || p.name.toLowerCase().includes("drone") || p.name.toLowerCase().includes("mavic") || p.name.toLowerCase().includes("avata") || p.name.toLowerCase().includes("matrice") || p.name.toLowerCase().includes("skyfend") || p.name.toLowerCase().includes("sentinel") || p.name.toLowerCase().includes("neo")) &&
            (p.name.toLowerCase().includes(lowerCaseSearchTerm) || p.spec.toLowerCase().includes(lowerCaseSearchTerm))
        );


        if (dronesToShow.length === 0) {
            droneVisitorList.innerHTML = '<p>Nenhum drone encontrado com esse termo.</p>';
        }

        dronesToShow.forEach(product => {
            const droneCard = document.createElement('div');
            droneCard.className = 'card product-card'; 
            droneCard.dataset.productId = product.id; 
            
            droneCard.innerHTML = `
                <h3>${product.name}</h3>
                <p class="product-spec"><strong>Especifica√ß√µes:</strong><br>${product.spec}</p>
                <p class="price" style="color: var(--secondary-color);">Consultar valor e disponibilidade</p>
                <div class="action-buttons-container">
                    <a href="https://wa.me/556236360668?text=${encodeURIComponent('Ol√°, gostaria de saber mais sobre o ' + product.name + ' e sua disponibilidade.')}" target="_blank" class="action-button whatsapp-button" style="width: auto;">Consultar via WhatsApp</a>
                    <button class="action-button help-product-visitor-btn" data-product-name="${product.name}" data-product-spec="${product.spec}">Precisa de ajuda com esse produto?</button>
                </div>
            `;
            droneVisitorList.appendChild(droneCard);
        });
    }

    function calculate(baseValue, numInstallments, paymentMethod, discountPercentage = 0) {
        const valor = parseFloat(baseValue);
        if (isNaN(valor) || valor <= 0) {
            return '<p style="color:red;">Valor base inv√°lido.</p>';
        }
        
        let taxa, valorFinal;

        taxa = INSTALLMENT_RATES[1] || 0;
        valorFinal = valor * (1 + taxa);

        if (currentUser.role === 'admin' && paymentMethod === 'vista' && discountPercentage > 0 && discountPercentage <= 15) {
            valorFinal = valorFinal * (1 - (discountPercentage / 100));
            valorFinal = parseFloat(valorFinal.toFixed(2)); 
        }

        let resultHTML = `<div class="result-vista">Valor √† Vista: ${valorFinal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</div>`;
        
        if (paymentMethod === 'parcelado') {
            const parcelas = parseInt(numInstallments);
            taxa = INSTALLMENT_RATES[parcelas] || 0;
            valorFinal = valor * (1 + taxa);
            const valorParcela = valorFinal / parcelas;
            const valorTaxa = valorFinal - valor;

            resultHTML += `
                <div class="result-parcelado">
                    <strong>Op√ß√£o Parcelado:</strong><br>
                    <span>Valor Final: <strong>${valorFinal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong></span><br>
                    <small>${parcelas}x de ${valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</small><br>
                    <small>Valor da taxa: ${valorTaxa.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</small>
                </div>
            `;
        }
        return resultHTML;
    }

    function switchTab(newSectionId) {
        const isVisitor = currentUser.isVisitor;
        const isSeller = currentUser.role === 'seller';
        const isAdmin = currentUser.role === 'admin';
        const isMikhaell = currentUser.username === 'mikhaell';
        const isTempUser = currentUser.type === 'temporary';

        // L√≥gica de acesso principal e visibilidade das se√ß√µes
        let canAccess = false;

        if (newSectionId === 'products-section' || newSectionId === 'calculator-section' || newSectionId === 'drones-visitor-section' || newSectionId === 'info-section') {
            if (isVisitor && (newSectionId === 'drones-visitor-section' || newSectionId === 'info-section')) {
                canAccess = true;
            } else if (!isVisitor && (newSectionId === 'products-section' || newSectionId === 'calculator-section' || newSectionId === 'drones-visitor-section' || newSectionId === 'info-section')) {
                canAccess = true;
            }
        } else if (newSectionId === 'suppliers-section') {
            if (isAdmin) {
                // Se o acesso a fornecedores j√° estava pendente (abriu o modal de senha), n√£o reabre
                if (pendingSupplierSectionAccess) {
                    canAccess = true; // Permite a navega√ß√£o ap√≥s senha correta
                } else {
                    // Se n√£o estava pendente, abre o modal de senha e retorna
                    supplierPasswordModal.style.display = 'block';
                    supplierAccessPasswordInput.value = '';
                    supplierPasswordError.style.display = 'none';
                    return; 
                }
            } else {
                alert('Esta se√ß√£o n√£o est√° dispon√≠vel para o seu perfil.');
                return;
            }
        } else if (newSectionId === 'settings-section' || newSectionId === 'create-product-section' || newSectionId === 'edit-product-section') {
            if (isAdmin) { // Admins podem acessar essas se√ß√µes
                canAccess = true;
            } else {
                alert('Esta se√ß√£o n√£o est√° dispon√≠vel para o seu perfil.');
                return;
            }
        } else if (newSectionId === 'manage-users-section') {
            if (isMikhaell) { // Apenas Mikhaell pode acessar Gerir Usu√°rios
                canAccess = true;
            } else {
                alert('Esta se√ß√£o est√° restrita ao administrador principal.');
                return;
            }
        }

        if (!canAccess) {
            // Se chegou aqui e n√£o pode acessar, retorna e mant√©m a aba ativa atual
            document.querySelector(`[data-section="${activeSectionId}"]`).classList.add('active');
            return;
        }


        // Continua√ß√£o da troca de aba
        contentSections.forEach(s => s.classList.remove('active')); 
        document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
        
        document.getElementById(newSectionId).classList.add('active');

        let targetButton = document.querySelector(`[data-section="${newSectionId}"]`);
        if (targetButton) {
            targetButton.classList.add('active');
            if (targetButton.classList.contains('sub-nav-button')) {
                settingsNavButton.classList.add('active');
            }
        }

        // NOVO: L√≥gica para mostrar/esconder o sub-menu de Configura√ß√µes
        if (newSectionId.includes('settings') && isAdmin) { // Agora todos os admins veem o sub-menu
            settingsSubNav.style.display = 'block';
        } else {
            settingsSubNav.style.display = 'none'; 
        }

        activeSectionId = newSectionId;

        // Fun√ß√µes de renderiza√ß√£o espec√≠ficas da se√ß√£o
        if (newSectionId === 'manage-users-section') renderTempUserList();
        if (newSectionId === 'products-section') renderProducts();
        if (newSectionId === 'drones-visitor-section') renderDroneVisitorList();


        if (window.innerWidth <= 768) {
            closeMobileNav();
        }
    }

    // --- GEST√ÉO DE USU√ÅRIOS TEMPOR√ÅRIOS ---
    function createTemporaryUser(event) {
        event.preventDefault();
        const username = document.getElementById('temp-username').value;
        const password = document.getElementById('temp-password').value;
        const durationHours = parseInt(document.getElementById('temp-duration').value);
        
        if (USERS[username]) {
            tempUserFeedback.textContent = 'Erro: Nome de usu√°rio j√° existe.'; tempUserFeedback.style.color = 'red'; return;
        }

        // NOVO: Usu√°rios tempor√°rios N√ÉO ter√£o firstLogin: true para n√£o serem for√ßados a trocar senha
        USERS[username] = { password, role: 'seller', type: 'temporary', expiresAt: Date.now() + durationHours * 60 * 60 * 1000, firstLogin: false };

        tempUserFeedback.textContent = `Usu√°rio "${username}" criado com sucesso!`; tempUserFeedback.style.color = 'green';
        createTempUserForm.reset(); renderTempUserList();
        setTimeout(() => tempUserFeedback.textContent = '', 5000);
    }
    
    function renderTempUserList() {
        tempUserListContainer.innerHTML = '';
        const tempUsers = Object.entries(USERS).filter(([_, user]) => user.type === 'temporary');

        if(tempUsers.length === 0) {
            tempUserListContainer.innerHTML = '<p>Nenhum usu√°rio tempor√°rio criado.</p>';
            return;
        }

        tempUsers.forEach(([username, user]) => {
            const item = document.createElement('div');
            item.className = 'temp-user-item';
            const expires = new Date(user.expiresAt).toLocaleString('pt-BR');
            item.innerHTML = `
                <div class="user-info">
                    <p><strong>${username}</strong></p>
                    <p><small>Expira em: ${expires}</small></p>
                </div>
                <div class="user-actions">
                    <button class="edit-btn" data-username="${username}">Editar</button>
                    <button class="delete-btn" data-username="${username}">Excluir</button>
                </div>
            `;
            item.querySelector('.edit-btn').addEventListener('click', () => openEditTempUserModal(username));
            item.querySelector('.delete-btn').addEventListener('click', () => deleteTempUser(username));
            tempUserListContainer.appendChild(item);
        });
    }

    function openEditTempUserModal(username) {
        const user = USERS[username];
        modalTitle.textContent = `Editar Usu√°rio: ${username}`;
        modalBody.innerHTML = `
            <form id="edit-temp-user-form">
                <div class="input-group"><label for="edit-temp-password">Nova Senha</label><input type="text" id="edit-temp-password" value="${user.password}" required></div>
                <div class="input-group"><label for="edit-temp-duration">Estender Dura√ß√£o (a partir de agora)</label><select id="edit-temp-duration">
                    <option value="1">1 Hora</option><option value="8">8 Horas</option><option value="24">24 Horas</option><option value="72">72 Horas</option>
                </select></div>
                <button type="submit" class="action-button">Salvar Altera√ß√µes</button>
            </form>
        `;
        openModal();
        document.getElementById('edit-temp-user-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('edit-temp-password').value;
            const newDuration = parseInt(document.getElementById('edit-temp-duration').value);
            USERS[username].password = newPassword;
            USERS[username].expiresAt = Date.now() + newDuration * 60 * 60 * 1000;
            closeModal();
            renderTempUserList();
        });
    }
    
    function deleteTempUser(username) {
        if (confirm(`Tem certeza que deseja excluir o usu√°rio tempor√°rio "${username}"?`)) {
            delete USERS[username];
            renderTempUserList();
            if (currentUser && currentUser.username === username) {
                handleLogout(); // Se o usu√°rio logado for o que est√° sendo exclu√≠do, desloga
                alert('Sua sess√£o foi encerrada, pois o usu√°rio tempor√°rio foi exclu√≠do.');
            }
        }
    }

    function getRemainingTime(expiry) {
        const total = expiry - Date.now();
        const seconds = Math.floor((total / 1000) % 60);
        const minutes = Math.floor((total / 1000 / 60) % 60);
        const hours = Math.floor((total / (1000 * 60 * 60)) % 24);
        return { hours, minutes, seconds };
    }
    
    function showTemporaryUserWarning() {
        clearInterval(tempUserInterval);
        function updateWarning() {
            const { hours, minutes, seconds } = getRemainingTime(currentUser.expiresAt);
            if (hours < 0 || minutes < 0 || seconds < 0) {
                modalBody.innerHTML = '<h2>Acesso Expirado</h2><p>O seu tempo de acesso terminou. A sess√£o ser√° encerrada.</p>';
                setTimeout(handleLogout, 3000);
                clearInterval(tempUserInterval);
            } else {
                modalBody.innerHTML = `<h2>Acesso Tempor√°rio</h2><p>Esta √© uma conta de convidado. O seu acesso ir√° expirar em:</p>
                <h3 style="text-align:center;">${hours}h ${minutes}m ${seconds}s</h3>`;
            }
        }
        updateWarning();
        modalTitle.textContent = "Aviso";
        openModal();
        tempUserInterval = setInterval(updateWarning, 1000);
    }

    // --- FUN√á√ïES DE CRIA√á√ÉO E ALTERA√á√ÉO DE PRODUTOS ---
    function generateNewProductId() {
        if (PRODUCTS.length === 0) return 1;
        const maxId = Math.max(...PRODUCTS.map(p => p.id));
        return maxId + 1;
    }

    function handleCreateProduct(event) {
        event.preventDefault();
        const name = document.getElementById('new-product-name').value.trim();
        const spec = document.getElementById('new-product-spec').value.trim();
        const salePrice = parseFloat(document.getElementById('new-product-sale-price').value);
        const costPrice = parseFloat(document.getElementById('new-product-cost-price').value);
        const supplier = document.getElementById('new-product-supplier').value.trim();

        if (!name || !spec || isNaN(salePrice) || salePrice <= 0) {
            createProductFeedback.textContent = 'Preencha todos os campos obrigat√≥rios (Nome, Especifica√ß√µes, Pre√ßo de Venda).';
            createProductFeedback.style.color = 'red';
            return;
        }

        const newProduct = {
            id: generateNewProductId(),
            name,
            spec,
            salePrice,
            sources: [{ 
                supplierName: supplier || 'N√£o especificado', 
                costPrice: isNaN(costPrice) ? 0 : costPrice 
            }] 
        };

        PRODUCTS.push(newProduct);
        createProductFeedback.textContent = `Produto "${newProduct.name}" (ID: ${newProduct.id}) criado com sucesso!`;
        createProductFeedback.style.color = 'green';
        createProductForm.reset();
        renderProducts(); 
    }

    function handleSearchProductToEdit() {
        const productId = parseInt(editProductSearchIdInput.value);
        if (isNaN(productId)) {
            editProductDisplay.innerHTML = '<p style="color:red;">Por favor, digite um ID de produto v√°lido.</p>';
            editProductForm.classList.add('hidden');
            return;
        }

        const product = PRODUCTS.find(p => p.id === productId);

        if (product) {
            editProductDisplay.innerHTML = `<p>Produto encontrado: <strong>${product.name}</strong> (ID: ${product.id})</p>`;
            editProductForm.classList.remove('hidden');
            editProductFeedback.textContent = ''; 

            editProductIdInput.value = product.id;
            editProductNameInput.value = product.name;
            editProductSpecTextarea.value = product.spec;
            editProductSalePriceInput.value = product.salePrice;
            editProductCostPriceInput.value = product.sources[0] ? product.sources[0].costPrice : '';
            editProductSupplierInput.value = product.sources[0] ? product.sources[0].supplierName : '';
        } else {
            editProductDisplay.innerHTML = '<p style="color:orange;">Produto n√£o encontrado com o ID fornecido.</p>';
            editProductForm.classList.add('hidden');
        }
    }

    function handleEditProduct(event) {
        event.preventDefault();
        const productId = parseInt(editProductIdInput.value);
        const productIndex = PRODUCTS.findIndex(p => p.id === productId);

        if (productIndex === -1) {
            editProductFeedback.textContent = 'Erro: Produto n√£o encontrado para altera√ß√£o.';
            editProductFeedback.style.color = 'red';
            return;
        }

        const name = editProductNameInput.value.trim();
        const spec = editProductSpecTextarea.value.trim();
        const salePrice = parseFloat(editProductSalePriceInput.value);
        const costPrice = parseFloat(editProductCostPriceInput.value);
        const supplier = editProductSupplierInput.value.trim();

        if (!name || !spec || isNaN(salePrice) || salePrice <= 0) {
            editProductFeedback.textContent = 'Preencha todos os campos obrigat√≥rios (Nome, Especifica√ß√µes, Pre√ßo de Venda).';
            editProductFeedback.style.color = 'red';
            return;
        }

        if (PRODUCTS[productIndex].sources && PRODUCTS[productIndex].sources.length > 0) {
            PRODUCTS[productIndex].sources[0].supplierName = supplier || 'N√£o especificado';
            PRODUCTS[productIndex].sources[0].costPrice = isNaN(costPrice) ? 0 : costPrice;
        } else {
            PRODUCTS[productIndex].sources = [{ 
                supplierName: supplier || 'N√£o especificado', 
                costPrice: isNaN(costPrice) ? 0 : costPrice 
            }];
        }

        PRODUCTS[productIndex].name = name;
        PRODUCTS[productIndex].spec = spec;
        PRODUCTS[productIndex].salePrice = salePrice;

        editProductFeedback.textContent = `Produto "${name}" (ID: ${productId}) atualizado com sucesso!`;
        editProductFeedback.style.color = 'green';
        renderProducts(); 
    }


    // --- FUN√á√ïES DE UTILIDADE GERAL ---
    function handleWhatsAppShare(product) {
        const salePrice = product.salePrice.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
        const message = `Ol√°! üëã\n\nEstou a enviar os detalhes sobre o *${product.name}* que convers√°mos. √â um equipamento fant√°stico! üöÄ\n\n*Especifica√ß√µes Principais:*\n${product.spec}\n\n*Valor de Venda:* ${salePrice}\n\nQualquer d√∫vida, estou √† disposi√ß√£o!\n- Equipa Galv√£o Drones`;
        const encodedMessage = encodeURIComponent(message);
        const whatsappUrl = `https://wa.me/?text=${encodedMessage}`; 
        window.open(whatsappUrl, '_blank');
    }

    function handleCustomerHelp(product) {
        modalTitle.textContent = `Assistente para: ${product.name}`;
        modalBody.innerHTML = `
            <div class="input-group">
                <label for="customer-question">Copie e cole a pergunta do cliente abaixo:</label>
                <textarea id="customer-question" rows="4"></textarea>
            </div>
            <button id="ask-gemini-button" class="action-button">Perguntar √† IA</button>
        `;
        openModal();

        document.getElementById('ask-gemini-button').addEventListener('click', () => {
            const customerQuestion = document.getElementById('customer-question').value;
             if (customerQuestion && customerQuestion.trim() !== '') {
                 const title = "Sugest√£o de Resposta para Cliente";
                 const prompt = `R2D2: Responda de forma direta e clara (m√°ximo 3 frases) √† seguinte d√∫vida do cliente, considerando estas especifica√ß√µes do produto: "${product.spec}". D√∫vida do cliente: "${customerQuestion}"`;
                 callGeminiAPI(prompt, title);
             }
        });
    }

    function handleVisitorProductHelp(productName, productSpec) {
        modalTitle.textContent = `Ajuda sobre: ${productName}`;
        modalBody.innerHTML = `
            <div class="input-group">
                <label for="visitor-product-question">Qual sua d√∫vida sobre o ${productName}?</label>
                <textarea id="visitor-product-question" rows="4"></textarea>
            </div>
            <button id="ask-gemini-visitor-product-button" class="action-button">Obter Ajuda da IA</button>
        `;
        openModal();

        document.getElementById('ask-gemini-visitor-product-button').addEventListener('click', () => {
            const visitorQuestion = document.getElementById('visitor-product-question').value;
            if (visitorQuestion && visitorQuestion.trim() !== '') {
                const title = "Resposta da Galv√£o Drones";
                callGeminiAPI(visitorQuestion, title, true, productSpec); 
            }
        });
    }

    // Fun√ß√£o para navegar para o fornecedor na se√ß√£o de Fornecedores
    function navigateToSupplierSection(supplierName) {
        // Redireciona para a se√ß√£o de fornecedores sem pedir senha novamente
        // Isso assume que o acesso j√° foi concedido ou √© permitido.
        contentSections.forEach(s => s.classList.remove('active'));
        document.getElementById('suppliers-section').classList.add('active');
        document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
        suppliersNavButton.classList.add('active'); // Ativa o bot√£o Fornecedores na navega√ß√£o
        activeSectionId = 'suppliers-section';

        setTimeout(() => {
            // Tenta encontrar o card do fornecedor com base no nome
            const targetSupplierCard = document.querySelector(`#supplier-list .supplier-card h3 strong[data-supplier-name="${supplierName}"]`);
            if (targetSupplierCard) {
                targetSupplierCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                targetSupplierCard.closest('.supplier-card').style.backgroundColor = '#fffacd'; 
                setTimeout(() => {
                    targetSupplierCard.closest('.supplier-card').style.backgroundColor = ''; 
                }, 3000);
            } else {
                console.log(`Fornecedor "${supplierName}" n√£o encontrado na lista detalhada.`);
            }
        }, 300); 
    }

    function showSuppliers() {
        supplierList.innerHTML = '';
        SUPPLIERS.forEach(supplier => {
            const supplierCard = document.createElement('div');
            supplierCard.className = 'card supplier-card';
            supplierCard.innerHTML = `
                <h3><strong data-supplier-name="${supplier.name}">${supplier.name}</strong></h3>
                <p><strong>Detalhes:</strong> ${supplier.details}</p>
                <div><strong>Pagamento:</strong><br>${supplier.payment.replace(/\n/g, '<br>')}</div>
                <p><strong>Produtos Principais:</strong> ${supplier.products}</p>
            `;
            supplierList.appendChild(supplierCard);
        });
        // Ap√≥s mostrar os fornecedores, fecha o modal de senha
        supplierPasswordModal.style.display = 'none'; 
    }

    // NOVO: Fun√ß√£o para exibir o modal de altera√ß√£o de senha
    function showChangePasswordModal(isMandatory = false) {
        changePasswordModal.style.display = 'block';
        newPasswordInput.value = '';
        confirmNewPasswordInput.value = '';
        changePasswordError.style.display = 'none';
        changePasswordSuccess.style.display = 'none';

        if (isMandatory) {
            changePasswordModalTitle.textContent = 'Defina Sua Senha';
            changePasswordMessage.textContent = 'Por favor, defina uma nova senha para sua conta. √â obrigat√≥rio no primeiro acesso.';
            changePasswordCloseButton.style.display = 'none'; // Esconde o bot√£o de fechar se for obrigat√≥rio
        } else {
            changePasswordModalTitle.textContent = 'Alterar Senha';
            changePasswordMessage.textContent = 'Digite sua nova senha abaixo.';
            changePasswordCloseButton.style.display = 'block'; // Mostra o bot√£o de fechar para altera√ß√£o volunt√°ria
        }
    }

    // NOVO: Fun√ß√£o para lidar com a submiss√£o do formul√°rio de altera√ß√£o de senha
    function handleChangePassword() {
        const newPass = newPasswordInput.value;
        const confirmPass = confirmNewPasswordInput.value;
        changePasswordError.style.display = 'none';
        changePasswordSuccess.style.display = 'none';

        if (newPass.length < 6) {
            changePasswordError.textContent = 'A nova senha deve ter no m√≠nimo 6 d√≠gitos.';
            changePasswordError.style.display = 'block';
            return;
        }
        if (newPass !== confirmPass) {
            changePasswordError.textContent = 'As senhas n√£o conferem.';
            changePasswordError.style.display = 'block';
            return;
        }

        // Atualiza a senha no objeto USERS
        USERS[currentUser.username].password = newPass;
        USERS[currentUser.username].firstLogin = false; // Define firstLogin como false

        changePasswordSuccess.textContent = 'Senha alterada com sucesso!';
        changePasswordSuccess.style.display = 'block';

        // Ap√≥s sucesso, pode fechar o modal ou dar um tempo e fechar
        setTimeout(() => {
            changePasswordModal.style.display = 'none';
            // Se a senha foi alterada porque era obrigat√≥rio no primeiro login, agora que pode prosseguir
            // Chama setupAppForUser() para re-configurar a UI e esconder o aviso de troca de senha
            setupAppForUser(); 
        }, 1500);
    }

    function openModal() { mainModal.style.display = 'block'; }
    function closeModal() { mainModal.style.display = 'none'; modalBody.innerHTML = ''; clearInterval(tempUserInterval); }
    function handleScroll() { mainContent.scrollTop > 200 ? scrollToTopButton.style.display = "block" : scrollToTopButton.style.display = "none"; }
    function scrollTop() { mainContent.scrollTo({ top: 0, behavior: 'smooth' }); }

    // --- EVENT LISTENERS ---
    loginButton.addEventListener('click', handleLogin);
    visitorModeButton.addEventListener('click', handleVisitorMode); 
    passwordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleLogin(); });
    logoutButton.addEventListener('click', handleLogout);
    
    // NOVO: Listener para o link de alterar senha no header
    changePasswordLink.addEventListener('click', () => showChangePasswordModal(false)); // false = n√£o obrigat√≥rio

    mainContent.addEventListener('click', (e) => {
        const target = e.target;
        const productCard = target.closest('.product-card');

        // L√≥gica para link de fornecedor em produto (apenas para admins)
        if (target.classList.contains('supplier-name-link')) {
            e.preventDefault(); 
            const supplierName = target.dataset.supplierName;
            if (currentUser && currentUser.role === 'admin') { 
                navigateToSupplierSection(supplierName);
            }
            return; 
        }

        // L√≥gica para o modo visitante (se√ß√£o Drones)
        if (currentUser && currentUser.isVisitor && target.classList.contains('help-product-visitor-btn')) {
            const productName = target.dataset.productName;
            const productSpec = target.dataset.productSpec;
            handleVisitorProductHelp(productName, productSpec);
            return; 
        }

        if (currentUser && currentUser.isVisitor) {
            return; 
        }

        if (productCard) {
            const productId = parseInt(productCard.dataset.productId);
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) return;
            
            if (target.classList.contains('desc-button')) {
                const title = `Descri√ß√£o para: ${product.name}`;
                const prompt = `R2D2: Gere uma descri√ß√£o de venda curta e apelativa para o produto "${product.name}", focando nos benef√≠cios e usando as especifica√ß√µes: ${product.spec}. N√£o inclua o pre√ßo.`;
                callGeminiAPI(prompt, title);
            } else if (target.classList.contains('args-button')) {
                const title = `Argumentos para: ${product.name}`;
                const prompt = `R2D2: Liste 3 a 4 argumentos de venda concisos para o produto "${product.name}", explicando brevemente por que cada um √© importante para o cliente, com base nas especifica√ß√µes: ${product.spec}.`;
                callGeminiAPI(prompt, title);
            } else if (target.classList.contains('whatsapp-button')) {
                const message = `Ol√°! üëã\n\nEstou a enviar os detalhes sobre o *${product.name}* que convers√°mos. √â um equipamento fant√°stico! üöÄ\n\n*Especifica√ß√µes Principais:*\n${product.spec}\n\n*Valor de Venda:* ${product.salePrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\n\nQualquer d√∫vida, estou √† disposi√ß√£o!\n- Equipa Galv√£o Drones`;
                const encodedMessage = encodeURIComponent(message);
                window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
            } else if (target.classList.contains('help-button')) {
                handleCustomerHelp(product);
            } else if (target.classList.contains('calculate-product-btn')) {
                const resultContainer = productCard.querySelector('.product-calculator-result');
                const paymentMethod = productCard.querySelector(`input[name="payment-method-${productId}"]:checked`).value;
                const numInstallments = productCard.querySelector('.parcelas-select').value;
                
                let discountPercentage = 0;
                const discountOptionDiv = productCard.querySelector(`#discount-option-${product.id}`);

                if (currentUser.role === 'admin' && paymentMethod === 'vista' && discountOptionDiv) {
                    const discountInput = productCard.querySelector(`#discount-percentage-${product.id}`);
                    if (discountInput) {
                        discountPercentage = parseFloat(discountInput.value);
                    }
                    discountOptionDiv.classList.remove('hidden'); 
                } else if (discountOptionDiv) {
                    discountOptionDiv.classList.add('hidden'); 
                }
                resultContainer.innerHTML = calculate(product.salePrice, numInstallments, paymentMethod, discountPercentage);
            }
        }
    });

    mainContent.addEventListener('change', (e) => {
        if (e.target.matches('input[name^="payment-method-"]')) {
            const card = e.target.closest('.product-card');
            const installmentsDiv = card.querySelector('.installments-container');
            const discountOptionDiv = card.querySelector('.discount-option');

            installmentsDiv.classList.toggle('hidden', e.target.value !== 'parcelado');
            
            if (discountOptionDiv && (e.target.value !== 'vista' || currentUser.role !== 'admin')) {
                discountOptionDiv.classList.add('hidden');
            }
        }
    });

    // Event listeners para os bot√µes de navega√ß√£o
    document.querySelectorAll('nav button').forEach(button => {
        button.addEventListener('click', () => {
            const sectionId = button.dataset.section;

            // L√≥gica para o bot√£o pai de Configura√ß√µes
            if (button.id === 'settings-nav-button') {
                if (currentUser && currentUser.role === 'admin') { // Apenas admins podem expandir
                    const isSubNavVisible = settingsSubNav.style.display === 'block';
                    settingsSubNav.style.display = isSubNavVisible ? 'none' : 'block';
                    settingsNavButton.classList.toggle('active', !isSubNavVisible); 
                    
                    if (!isSubNavVisible) {
                        switchTab('settings-section'); 
                    }
                } else {
                    alert('Esta se√ß√£o est√° restrita ao perfil de administrador.');
                }
                return; 
            }
            
            // Para todos os outros bot√µes (incluindo os sub-bot√µes de Configura√ß√µes)
            switchTab(sectionId);
        });
    });
    
    closeModalButton.addEventListener('click', closeModal);
    window.addEventListener('click', (event) => { 
        if (event.target == mainModal) { closeModal(); } 
        // NOVO: Fechar modal de senha do fornecedor se clicar fora
        if (event.target == supplierPasswordModal) {
            supplierPasswordModal.style.display = 'none';
            pendingSupplierSectionAccess = false; 
            // Opcional: Se o usu√°rio fechar o modal, redireciona para uma se√ß√£o "segura"
            switchTab('products-section'); 
        }
        // NOVO: Fechar modal de altera√ß√£o de senha se clicar fora e n√£o for obrigat√≥rio
        // Verifica se o bot√£o de fechar do modal de senha est√° vis√≠vel. Se sim, n√£o √© um fechamento obrigat√≥rio.
        if (event.target == changePasswordModal && changePasswordCloseButton.style.display !== 'none') {
            changePasswordModal.style.display = 'none';
        }
    });
    productSearchInput.addEventListener('input', (e) => renderProducts(e.target.value));
    droneVisitorSearchInput.addEventListener('input', (e) => renderDroneVisitorList(e.target.value)); 
    
    // Listeners para Formul√°rios de Configura√ß√µes
    createTempUserForm.addEventListener('submit', createTemporaryUser);
    createProductForm.addEventListener('submit', handleCreateProduct);
    searchProductToEditButton.addEventListener('click', handleSearchProductToEdit);
    editProductForm.addEventListener('submit', handleEditProduct);


    mainContent.addEventListener('scroll', handleScroll);
    scrollToTopButton.addEventListener('click', scrollTop);
    
    generalCalculateButton.addEventListener('click', () => {
        const baseValue = generalCalcValorBase.value;
        const paymentMethod = document.querySelector('input[name="general-payment-method"]:checked').value;
        const numInstallments = generalCalcParcelasSelect.value;
        
        let discountPercentage = 0;
        generalCalculatorResult.innerHTML = calculate(baseValue, numInstallments, paymentMethod, discountPercentage);
    });

    generalCalcPaymentRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
            generalCalcInstallmentsContainer.classList.toggle('hidden', e.target.value !== 'parcelado');
        });
    });

    navToggleButton.addEventListener('click', () => {
        navElement.classList.toggle('nav-open');
        navToggleButton.textContent = navElement.classList.contains('nav-open') ? '‚úï' : '‚ò∞';
    });

    navToggleButtonClose.addEventListener('click', () => {
        closeMobileNav();
    });

    function closeMobileNav() {
        if (window.innerWidth <= 768) { 
            navElement.classList.remove('nav-open');
            navToggleButton.textContent = '‚ò∞';
        }
    }

    aiChatButton.addEventListener('click', () => {
        aiChatModal.style.display = 'block';
        aiQuestionInput.value = ''; 
        aiResponseArea.innerHTML = ''; 
        aiResponseArea.style.display = 'none'; 
        aiLoader.style.display = 'none'; 
    });

    aiChatCloseButton.addEventListener('click', () => {
        aiChatModal.style.display = 'none';
    });

    submitAiQuestionButton.addEventListener('click', () => {
        const question = aiQuestionInput.value.trim();
        if (question) {
            callGeminiAPI(question, "Resposta da IA", false, '', true); 
        }
    });

    // NOVO: Listeners para o modal de senha do fornecedor
    submitSupplierPasswordButton.addEventListener('click', () => {
        const enteredPassword = supplierAccessPasswordInput.value.trim();
        if (enteredPassword === CONFIDENTIAL_CODE) {
            supplierPasswordModal.style.display = 'none';
            // Chama a fun√ß√£o de troca de aba e renderiza os fornecedores
            switchTab('suppliers-section'); 
            pendingSupplierSectionAccess = false; 
        } else {
            supplierPasswordError.style.display = 'block';
            supplierAccessPasswordInput.value = ''; 
        }
    });

    supplierAccessPasswordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            submitSupplierPasswordButton.click();
        }
    });

    supplierPasswordCloseButton.addEventListener('click', () => {
        supplierPasswordModal.style.display = 'none';
        pendingSupplierSectionAccess = false; 
        switchTab('products-section'); // Volta para uma se√ß√£o padr√£o
    });

    // NOVO: Listeners para o modal de altera√ß√£o de senha
    submitChangePasswordButton.addEventListener('click', handleChangePassword);
    newPasswordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChangePassword(); });
    confirmNewPasswordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChangePassword(); });
    
    changePasswordCloseButton.addEventListener('click', () => {
        // Se o bot√£o de fechar for vis√≠vel (n√£o √© obrigat√≥rio), apenas fecha.
        // Se n√£o for vis√≠vel (√© obrigat√≥rio), alerta e reabre.
        if (changePasswordCloseButton.style.display !== 'none') {
            changePasswordModal.style.display = 'none';
        } else {
            alert('A altera√ß√£o de senha √© obrigat√≥ria para o primeiro acesso. Por favor, defina sua nova senha.');
            // Opcional: Aqui voc√™ pode adicionar um pequeno atraso antes de reabrir
            // para que o usu√°rio veja a mensagem.
            // setTimeout(() => showChangePasswordModal(true), 100); 
        }
    });
});
</script>

</body>
</html>