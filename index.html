<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Consultas Internas - Galvão Drones</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230E5847'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v4h4v2h-4v4h-2v-4H7v-2h4V8z'%3E%3C/path%3E%3Cpath d='M13.25 7.15c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L8.4 9.16c-.24.24-.36.58-.36.92s.12.68.36.92l.71.71c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71zM10.75 16.85c.24.24.58.36.92.36s-.68-.12.92-.36l2.93-2.93c-.24-.24-.36-.58-.36-.92s-.12-.68-.36-.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36l-2.93 2.93c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71zM18.8 8.4l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L13.3 9.77c-.24.24-.36.58-.36.92s-.12.68.36.92l.71.71c.24.24.58.36.92.36s-.68-.12.92-.36l3.85-3.85c-.24-.24-.36-.58-.36.92s-.12-.68-.36-.92zM5.2 15.6l.71.71c-.24.24-.58.36-.92.36s-.68-.12-.92.36l3.85-3.85c-.24-.24-.36.58-.36.92s-.12.68-.36.92l-.71-.71c-.24-.24-.58-.36-.92-.36s-.68.12-.92.36L5.2 14.68c-.24.24-.36.58-.36.92s-.12.68.36.92z'%3E%3C/path%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        /* --- ESTILOS GERAIS (CSS) COM A PALETA GALVÃO DRONES --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --primary-color: #EF7E13; /* Laranja Galvão Drones */
            --secondary-color: #0E5847; /* Verde Galvão Drones */
            --light-grey: #f4f7f6;
            --medium-grey: #ecf0f1;
            --dark-grey: #bdc3c7;
            --danger-color: #e74c3c;
            --whatsapp-color: #25D366;
            --instagram-color: #C13584; /* Cor do Instagram */
            --youtube-color: #FF0000; /* Cor do YouTube */
            --help-color: #5865F2;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--light-grey);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: relative; /* Adicionado para o pseudo-elemento */
        }

        /* Adiciona a imagem de fundo com opacidade */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.pexels.com/photos/2246476/pexels-photo-2246476.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.1; /* Opacidade da imagem de fundo */
            z-index: -1;
            transition: background-image 0.5s ease-in-out, opacity 0.5s ease-in-out; /* Adiciona transição */
        }

        /* Nova classe para o fundo do modo visitante */
        body.visitor-mode-bg::before {
            background-image: url('https://i.imgur.com/b3lg2eE.png'); /* URL da sua logo no Imgur */
            background-size: contain; /* Ajusta a imagem para caber sem cortar */
            background-position: center center; /* Centraliza a imagem */
            background-repeat: no-repeat; /* Evita repetição */
            opacity: 0.5; /* Ajuste a opacidade conforme preferir */
        }


        .container {
            width: 100%;
            max-width: 1200px;
            margin: 20px;
            z-index: 1;
        }

        /* --- TELA DE LOGIN --- */
        #login-screen {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            transition: opacity 0.5s ease;
            margin: auto; /* Garante centralização */
        }
        #company-logo {
            max-width: 300px; /* Ajuste a largura máxima conforme necessário */
            width: 80%;
            display: block;
            margin: 0 auto 10px auto; /* Centraliza a imagem e adiciona margem inferior */
        }
        #portal-subtitle {
             color: #555;
             margin-top: 0;
             margin-bottom: 40px;
             font-size: 1.2em;
             font-weight: 400;
        }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
        }
        .action-button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px; /* Adicionado para separar botões */
        }
        .action-button:hover {
            opacity: 0.9;
        }
        #login-error {
            color: var(--danger-color);
            margin-top: 15px;
            font-weight: 500;
            display: none;
        }
        #visitor-mode-button {
            background-color: var(--dark-grey);
        }
        #visitor-mode-button:hover {
            background-color: #95a5a6;
        }


        /* --- TELA PRINCIPAL DO APP --- */
        #app-screen {
            display: none; /* Começa escondida */
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: opacity 0.5s ease;
        }
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px; /* Altura fixa para o header */
        }
        
        /* Botão de menu hambúrguer no cabeçalho */
        .nav-toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0 10px;
            display: none; /* Oculto em desktop */
        }

        /* Container do ícone de perfil */
        #profile-icon-container {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: transform 0.2s ease-in-out;
        }

        #profile-icon-container:hover {
            transform: scale(1.05);
        }

        #profile-icon {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Container do nome de boas-vindas e título */
        .header-content { 
            display: flex; 
            align-items: center; 
            gap: 15px;
            flex-grow: 1;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
            text-align: center;
            flex-grow: 1;
        }
        
        header #logout-button {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block; 
            flex-shrink: 0;
        }
        header #logout-button:hover {
            background-color: #c0392b;
        }

        .visitor-header #welcome-message {
            display: none;
        }

        #change-password-link {
            display: none !important;
        }


        .app-body {
            display: flex;
            position: relative;
            min-height: calc(100vh - 60px);
        }
        nav {
            width: 200px;
            min-width: 200px;
            background-color: var(--medium-grey);
            padding: 20px 0;
            border-right: 1px solid var(--dark-grey);
            transition: transform 0.3s ease;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .nav-item-group {
            width: 100%;
            position: relative;
        }

        .sub-nav {
            background-color: var(--dark-grey);
            padding-left: 10px;
        }

        .sub-nav-button {
            font-size: 0.95em;
            padding: 10px 20px;
            border-bottom: 1px solid #c0c0c0;
        }
        .sub-nav-button:last-child {
            border-bottom: none;
        }
        .sub-nav-button.active, .sub-nav-button:hover {
            background-color: #a0a0a0;
            color: white;
        }

        /* --- FILTROS --- */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .section-header h2 {
            margin: 0;
        }
        .filter-container {
            position: relative;
        }
        .filter-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-button:hover {
            opacity: 0.9;
        }
        .filter-options {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 100;
            width: 220px;
            padding: 10px;
        }
        .filter-options.show {
            display: block;
        }
        .filter-group {
            margin-bottom: 10px;
        }
        .filter-group label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .filter-group select, .filter-group div {
            width: 100%;
        }
        .filter-group input[type="radio"], .filter-group input[type="checkbox"] {
            margin-right: 5px;
        }


        /* Oculta nav por padrão no mobile, prepara para slide-in */
        @media (max-width: 768px) {
            header {
                padding: 10px 15px;
                justify-content: space-between;
            }
            .nav-toggle-btn {
                display: block; /* Mostra o botão no mobile */
                order: -1; /* Coloca no início */
            }
            header h1 {
                font-size: 20px;
                text-align: left; /* Alinha o título à esquerda no mobile */
                margin-left: 10px;
            }
            #welcome-message {
                display: none; /* Oculta a mensagem de boas-vindas para dar espaço */
            }
            .header-content {
                justify-content: flex-start;
            }

            nav {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                width: 250px;
                min-width: 250px;
                transform: translateX(-100%);
                z-index: 999;
                box-shadow: 2px 0 5px rgba(0,0,0,0.2);
                padding-top: 0; /* Remove o padding-top antigo */
                border-right: 1px solid var(--dark-grey);
            }
            nav.nav-open {
                transform: translateX(0);
            }
            .nav-header {
                display: flex;
                position: relative; /* Mudado de absolute */
                width: 100%;
                height: 60px;
                background-color: var(--secondary-color);
                color: white;
                padding: 15px 20px;
                box-sizing: border-box;
                align-items: center;
            }
            .nav-header #nav-toggle-btn-close {
                font-size: 24px;
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                padding: 0 10px;
            }
             .nav-header span {
                flex-grow: 1;
                text-align: center;
                margin-left: -20px;
                font-size: 1.2em;
            }
            .app-body {
                flex-direction: column;
                min-height: calc(100vh - 60px);
            }

            main {
                width: 100%;
                box-sizing: border-box;
            }

            /* CORREÇÃO DO FILTRO PARA MOBILE */
            .filter-options {
                position: fixed; /* Mudar para fixo para sobrepor tudo */
                right: 5%;
                left: 5%;
                width: 90%;
                top: auto;
                bottom: 10%; /* Posicionar na parte inferior da tela */
                max-height: 70vh;
                overflow-y: auto;
            }
        }

        nav button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            background: none;
            border: none;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.3s, color 0.3s;
        }
        nav button.active, nav button:hover {
            background-color: var(--dark-grey);
            color: var(--secondary-color);
            font-weight: 700;
        }
        .nav-header {
            display: none; 
            align-items: center;
            padding: 15px 20px;
            background-color: var(--dark-grey);
            color: var(--secondary-color);
            font-weight: 700;
        }
        .nav-header span {
            margin-left: 10px;
        }

        main {
            flex-grow: 1;
            padding: 30px;
            max-height: calc(100vh - 60px);
            overflow-y: auto;
            position: relative;
            transition: margin-left 0.3s ease;
        }
        @media (max-width: 768px) {
            main {
                padding: 20px;
                max-height: calc(100vh - 60px);
                width: 100%;
            }
        }


        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .content-section h2, .content-section h3 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            color: var(--secondary-color);
        }
        .content-section h3 {
             border-bottom: 1px solid var(--dark-grey);
             font-size: 1.2em;
             margin-top: 30px;
        }

        #settings-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        #settings-options-grid .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        #settings-options-grid .card h3 {
            color: var(--primary-color);
            font-size: 1.5em;
            margin-bottom: 10px;
            border-bottom: none;
        }
        #settings-options-grid .card p {
            font-size: 0.9em;
            color: #666;
        }

        .back-to-settings-button {
            background-color: var(--dark-grey);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            display: inline-block;
            width: auto;
        }

        .back-to-settings-button:hover {
            background-color: #95a5a6;
        }


        .search-bar {
            margin-bottom: 20px;
            position: relative;
        }
        .search-bar input {
            width: 100%; padding: 12px 12px 12px 40px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;
        }
        .search-bar::before {
            content: '🔎'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.6;
        }
        
        .card {
            position: relative;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
            transition: box-shadow 0.3s;
            z-index: 1;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("https://i.imgur.com/b3lg2eE.png");
            background-size: 50%;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.08;
            z-index: -1;
            border-radius: 5px;
        }
        .card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .card h3 { margin-top: 0; color: var(--secondary-color); border: none; font-size: 1.3em; }
        .product-card { border-left: 5px solid var(--primary-color); }
        .supplier-card { border-left: 5px solid var(--secondary-color); }
        .info-card { border-left: 5px solid var(--secondary-color); }
        .product-spec { white-space: pre-wrap; line-height: 1.6; font-size: 0.95em; }

        .price { font-size: 1.2em; font-weight: 700; color: #27ae60; }
        .cost-price { font-size: 1.1em; font-weight: 700; color: var(--danger-color); background-color: #fdd; padding: 5px; border-radius: 4px; display: inline-block; margin-top: 10px; }
        .supplier-info { font-size: 0.9em; font-weight: 500; color: var(--secondary-color); background-color: #e8f8f5; padding: 5px 8px; border-radius: 4px; display: inline-block; margin-top: 10px; margin-left: 10px;}
        
        /* --- ESTILOS PARA FORNECEDORES --- */
        #supplier-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        #supplier-actions .action-button {
            width: auto;
            padding: 10px 15px;
            font-size: 0.95em;
        }
        .supplier-card .contact-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        .supplier-card .contact-list li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .supplier-card .contact-list li:last-child {
            border-bottom: none;
        }
        .supplier-card .contact-info {
            font-size: 0.95em;
        }
        .supplier-card .contact-info strong {
            color: #333;
        }
        .supplier-card .contact-info span {
            color: #777;
            font-style: italic;
        }
        .whatsapp-contact-btn {
            background-color: var(--whatsapp-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 18px;
            transition: transform 0.2s;
        }
        .whatsapp-contact-btn:hover {
            transform: scale(1.1);
        }
        .supplier-card .categories {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .supplier-card .category-tag {
            background-color: var(--medium-grey);
            color: #555;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }
        .product-suppliers-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
            font-size: 0.9em;
        }
        .product-suppliers-list li {
            background-color: #f8f8f8;
            padding: 5px 10px;
            border-radius: 3px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #eee;
        }
        .product-suppliers-list li .supplier-name-link {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: bold;
        }
        .product-suppliers-list li .cost-value {
            color: var(--danger-color);
            font-weight: 500;
        }
        .action-buttons-container { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; }
        .action-buttons-container button, .action-buttons-container a.action-button {
            color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 500; transition: background-color 0.3s;
            font-size: 0.9em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .gemini-button { background-color: var(--secondary-color); }
        .whatsapp-button { background-color: var(--whatsapp-color); }
        .instagram-button { background-color: var(--instagram-color); }
        .youtube-button { background-color: var(--youtube-color); }
        .google-maps-button { background-color: #4285F4; }

        .help-button { background-color: var(--help-color); }
        .action-buttons-container button:hover, .action-buttons-container a.action-button:hover { opacity: 0.9; }

        .calculator-container { margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--dark-grey); }
        .payment-method-selector label { display: inline-block; margin-right: 15px; cursor: pointer; font-size: 0.95em; }
        .payment-method-selector input { margin-right: 5px; }
        .installments-container { margin-top: 10px; }
        .calculate-product-btn { background-color: var(--secondary-color); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px;}
        .product-calculator-result, #general-calculator-result { margin-top: 15px; font-size: 1.1em; color: var(--secondary-color); background-color: #eaf5ff; padding: 15px; border-radius: 5px; }
        .result-vista { font-weight: bold; }
        .result-parcelado { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--dark-grey); }
        .result-parcelado small { font-size: 0.9em; font-weight: normal; color: #555; }
        
        .discount-option {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .discount-option input[type="number"] {
            width: 80px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: transparent;
            position: relative;
            z-index: 1;
        }
        .discount-option label {
            margin-bottom: 0;
        }
        .discount-option::after {
            content: "max. 15%";
            position: absolute;
            left: 105px;
            color: #ccc;
            font-size: 0.8em;
            opacity: 0.8;
            pointer-events: none;
            white-space: nowrap;
            transform: translateY(2px);
            z-index: 0;
        }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); padding-top: 60px; }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .loader { border: 8px solid #f3f3f3; border-radius: 50%; border-top: 8px solid var(--primary-color); width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen">
            <img src="https://i.imgur.com/b3lg2eE.png" alt="Logotipo Galvão Drones" id="company-logo">
            <h2 id="portal-subtitle">Portal Interno</h2>
            <div class="input-group"><label for="username">Usuário</label><input type="text" id="username" placeholder="Digite seu nome"></div>
            <div class="input-group"><label for="password">Senha</label><input type="password" id="password" placeholder="Sua senha"></div>
            <button id="login-button" class="action-button">Entrar</button>
            <button id="visitor-mode-button" class="action-button">Modo Visitante</button>
            <p id="login-error">Usuário ou senha inválidos.</p>
        </div>

        <div id="app-screen">
            <header>
                <button id="nav-toggle-btn" class="nav-toggle-btn">☰</button>
                <div class="header-content">
                    <div id="profile-icon-container">
                        <img id="profile-icon" src="https://i.imgur.com/8Yd00YF.png" alt="Foto de Perfil"> 
                    </div>
                    <span id="welcome-message"></span>
                    <h1>Portal Interno</h1>
                </div>
                <button id="logout-button">Sair</button>
            </header>
            <div class="app-body">
                <nav>
                    <div class="nav-header">
                        <button id="nav-toggle-btn-close" class="nav-toggle-btn">✕</button>
                        <span>Menu</span>
                    </div>
                    <button class="nav-button" data-section="products-section" id="products-nav-button" style="order: 1;">Produtos</button>
                    <button class="nav-button" data-section="calculator-section" id="calculator-nav-button" style="order: 2;">Calculadora</button>
                    <button class="nav-button" data-section="suppliers-section" id="suppliers-nav-button" style="order: 3;">Fornecedores</button>
                    
                    <div class="nav-item-group" style="order: 4;">
                        <button class="nav-button" data-section="settings-section" id="settings-nav-button">Configurações</button>
                        <div class="sub-nav" id="settings-sub-nav" style="display: none;">
                            <button class="nav-button sub-nav-button" data-section="manage-users-section" id="manage-users-nav-button">Gerir Usuários</button>
                            <button class="nav-button sub-nav-button" data-section="create-product-section" id="create-product-nav-button">Criar Produto</button>
                            <button class="nav-button sub-nav-button" data-section="edit-product-section" id="edit-product-nav-button">Alterar Produto</button>
                        </div>
                    </div>
                    
                    <button class="nav-button" data-section="drones-visitor-section" id="drones-nav-button" style="order: 5;">Drones</button>
                    <button class="nav-button" data-section="info-section" id="info-empresa-nav-button" style="order: 6;">Info Empresa</button>
                    <button class="nav-button" data-section="marketing-section" id="marketing-nav-button" style="order: 7;">Marketing</button>
                    <button class="nav-button hidden" data-section="profile-section" id="profile-nav-button" style="order: 8;">Meu Perfil</button>
                </nav>
                <main id="main-content">
                    <section id="products-section" class="content-section active">
                        <div class="section-header">
                            <h2>Consulta de Produtos</h2>
                        </div>
                        <div class="search-bar"><input type="text" id="product-search" placeholder="Pesquisar por nome ou especificação..."></div>
                        <div id="product-list"></div>
                    </section>
                    <section id="calculator-section" class="content-section">
                        <h2>Calculadora Geral</h2>
                        <div class="card">
                           <div class="input-group">
                                <label for="general-valor-base">Valor Base</label>
                                <input type="number" id="general-valor-base" class="input-full" placeholder="Digite o valor para simulação">
                           </div>
                           <div class="input-group">
                                <label>Forma de Pagamento</label>
                                <div id="general-payment-method-selector">
                                    <input type="radio" id="general-payment-vista" name="general-payment-method" value="vista" checked>
                                    <label for="general-payment-vista">À vista</label>
                                    <input type="radio" id="general-payment-parcelado" name="general-payment-method" value="parcelado">
                                    <label for="general-payment-parcelado">Parcelado</label>
                                </div>
                           </div>
                           <div class="discount-option hidden" id="general-discount-option">
                               <label for="general-discount-percentage">Desconto (%):</label>
                               <input type="number" id="general-discount-percentage" min="0" max="15" value="0">
                           </div>
                           <div class="input-group hidden" id="general-installments-container">
                                <label for="general-parcelas">Número de Parcelas</label>
                                <select id="general-parcelas">
                                    <option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="4">4x</option><option value="5">5x</option><option value="6">6x</option><option value="7">7x</option><option value="8">8x</option><option value="9">9x</option><option value="10">10x</option><option value="11">11x</option><option value="12">12x</option>
                                </select>
                           </div>
                           <button id="general-calculate-button" class="action-button" style="width: auto; padding: 10px 20px;">Calcular</button>
                           <div id="general-calculator-result">O resultado da simulação aparecerá aqui.</div>
                          </div>
                    </section>
                    <section id="suppliers-section" class="content-section">
                        <div class="section-header">
                            <h2>Fornecedores (Acesso Confidencial)</h2>
                            <div class="filter-container">
                                <button class="filter-button" id="supplier-filter-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/></svg>
                                    Filtrar
                                </button>
                                <div class="filter-options" id="supplier-filter-options">
                                    <div class="filter-group">
                                        <label>Ordenar por:</label>
                                        <div>
                                            <input type="radio" id="sort-supplier-alpha" name="sort-supplier" value="alpha" checked>
                                            <label for="sort-supplier-alpha">Ordem Alfabética</label>
                                        </div>
                                    </div>
                                    <div class="filter-group">
                                        <label>Filtrar por Categoria:</label>
                                        <div>
                                            <input type="checkbox" id="cat-supplier-consumer" name="cat-supplier" value="Consumer">
                                            <label for="cat-supplier-consumer">Consumer</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="cat-supplier-enterprise" name="cat-supplier" value="Enterprise">
                                            <label for="cat-supplier-enterprise">Enterprise</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="cat-supplier-agriculture" name="cat-supplier" value="Agriculture">
                                            <label for="cat-supplier-agriculture">Agriculture</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="cat-supplier-pecas" name="cat-supplier" value="Peças">
                                            <label for="cat-supplier-pecas">Peças</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="supplier-actions">
                            <button id="create-supplier-btn" class="action-button">Criar Fornecedor</button>
                            <button id="edit-supplier-btn" class="action-button">Alterar Fornecedor</button>
                            <button id="request-quote-btn" class="action-button">Solicitar Orçamento</button>
                        </div>
                        <div id="supplier-list"></div>
                    </section>
                    <section id="settings-section" class="content-section">
                        <h2>Configurações do Sistema</h2>
                        <p>Selecione uma opção de configuração no menu lateral, ou clique nos atalhos abaixo:</p>
                        <div id="settings-options-grid"></div>
                    </section>

                    <section id="manage-users-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Gerir Usuários Temporários</h2>
                        <div class="card">
                            <h3>Criar Usuário Temporário</h3>
                            <form id="create-temp-user-form">
                                <div class="input-group"><label for="temp-username">Nome de Usuário</label><input type="text" id="temp-username" required></div>
                                <div class="input-group"><label for="temp-password">Senha</label><input type="text" id="temp-password" required></div>
                                <div class="input-group"><label for="temp-duration">Duração do Acesso</label><select id="temp-duration"><option value="1">1 Hora</option><option value="8">8 Horas</option><option value="24" selected>24 Horas</option><option value="72">72 Horas</option></select></div>
                                <button type="submit" class="action-button">Criar Usuário</button>
                                <p id="temp-user-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                        <div id="temp-user-list-container">
                            <h3>Usuários Temporários Ativos</h3>
                            <div id="temp-user-list" class="card"></div>
                        </div>
                    </section>

                    <section id="create-product-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Criar Novo Produto</h2>
                        <div class="card">
                            <form id="create-product-form">
                                <div class="input-group"><label for="new-product-name">Nome do Produto</label><input type="text" id="new-product-name" required></div>
                                <div class="input-group"><label for="new-product-spec">Especificações</label><textarea id="new-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="new-product-sale-price">Preço de Venda (R$)</label><input type="number" id="new-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="new-product-cost-price">Preço de Custo (R$)</label><input type="number" id="new-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group"><label for="new-product-supplier">Fornecedor Principal</label><input type="text" id="new-product-supplier"></div>
                                <button type="submit" class="action-button">Salvar Novo Produto</button>
                                <p id="create-product-feedback" style="margin-top: 15px; font-weight: bold;"></p>
                            </form>
                        </div>
                    </section>

                    <section id="edit-product-section" class="content-section">
                        <button class="back-to-settings-button" onclick="window.switchTab('settings-section')">← Voltar para Configurações</button>
                        <h2>Alterar Produto Existente</h2>
                        <div class="card">
                            <div class="input-group">
                                <label for="edit-product-search-input">Buscar Produto (ID ou Nome)</label>
                                <input type="text" id="edit-product-search-input" placeholder="Digite o ID ou nome do produto">
                                <button id="search-product-to-edit" class="action-button" style="width: auto; margin-top: 10px;">Buscar</button>
                            </div>
                            <div id="edit-product-search-results" style="margin-top: 15px;"></div>
                            
                            <div id="edit-product-display" style="margin-top: 20px;">
                                <p>Use a busca acima para carregar os dados do produto.</p>
                            </div>
                            <form id="edit-product-form" class="hidden">
                                <input type="hidden" id="edit-product-id">
                                <div class="input-group"><label for="edit-product-name">Nome do Produto</label><input type="text" id="edit-product-name" required></div>
                                <div class="input-group"><label for="edit-product-spec">Especificações</label><textarea id="edit-product-spec" rows="5"></textarea></div>
                                <div class="input-group"><label for="edit-product-sale-price">Preço de Venda (R$)</label><input type="number" id="edit-product-sale-price" step="0.01" min="0" required></div>
                                <div class="input-group"><label for="edit-product-cost-price">Preço de Custo (R$)</label><input type="number" id="edit-product-cost-price" step="0.01" min="0"></div>
                                <div class="input-group"><label for="edit-product-supplier">Fornecedor Principal</label><input type="text" id="edit-product-supplier"></div>
                                <button type="submit" class="action-button">Salvar Alterações</button>
                                <p id="edit-product-feedback" class="profile-feedback"></p>
                            </form>
                        </div>
                    </section>

                    <section id="drones-visitor-section" class="content-section">
                        <div class="section-header">
                            <h2>Modelos de Drones</h2>
                            <div class="filter-container">
                                <button class="filter-button" id="drone-filter-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/></svg>
                                    Filtrar
                                </button>
                                <div class="filter-options" id="drone-filter-options">
                                    <div class="filter-group">
                                        <label>Ordenar por:</label>
                                        <select id="sort-drone-order">
                                            <option value="alpha">Ordem Alfabética</option>
                                            <option value="price-asc">Menor Valor</option>
                                            <option value="price-desc">Maior Valor</option>
                                        </select>
                                    </div>
                                    <div class="filter-group">
                                        <label>Filtrar por Linha:</label>
                                        <div>
                                            <input type="checkbox" id="line-drone-consumer" name="line-drone" value="Consumer">
                                            <label for="line-drone-consumer">Consumer</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="line-drone-enterprise" name="line-drone" value="Enterprise">
                                            <label for="line-drone-enterprise">Enterprise</label>
                                        </div>
                                        <div>
                                            <input type="checkbox" id="line-drone-agriculture" name="line-drone" value="Agriculture">
                                            <label for="line-drone-agriculture">Agriculture</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="search-bar"><input type="text" id="drone-visitor-search" placeholder="Pesquisar por modelo ou especificação..."></div>
                        <div id="drone-visitor-list"></div>
                    </section>
                    <section id="info-section" class="content-section">
                        <h2>Informações da Empresa</h2>
                        <div class="card info-card">
                            <p><strong>Nome da Empresa:</strong> Galvão Drones</p>
                            <p id="cnpj-display-line"><strong>CNPJ:</strong> 60.102.179/0001-10</p>
                            <p><strong>Endereço:</strong> Rua 16, nº 304 – Setor Aeroviário, Goiânia – GO, CEP: 74435-240</p>
                            <p><a href="https://www.google.com/maps/search/?api=1&query=Rua+16,+304,+Setor+Aerovi%C3%A1rio,+Goi%C3%A2nia+-+GO,+74435-240" target="_blank" class="action-button google-maps-button" style="width: auto; padding: 10px 15px; margin-right: 10px;">Ver no Google Maps</a></p>
                            <p><strong>Contato:</strong> <span id="company-phone">(62) 3636-0668</span></p>
                            <div class="contact-buttons-container" style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                                <a href="https://www.instagram.com/galvao_drones" target="_blank" class="action-button instagram-button" style="width: auto; padding: 10px 15px;">Instagram</a>
                                <a href="https://wa.me/556236360668" target="_blank" class="action-button whatsapp-button" id="company-whatsapp-link" style="width: auto; padding: 10px 15px;">WhatsApp</a>
                                <a href="https://www.youtube.com/@galvaodrones" target="_blank" class="action-button youtube-button" style="width: auto; padding: 10px 15px;">YouTube</a>
                            </div>
                            <p><strong>Website:</strong> <a href="http://www.galvaodrones.com.br" target="_blank">www.galvaodrones.com.br</a></p>
                        </div>
                    </section>

                    <section id="profile-section" class="content-section">
                        <h2>Meu Perfil</h2>
                        <div class="card">
                            <div class="profile-header">
                                <img id="profile-pic-display" src="https://i.imgur.com/8Yd00YF.png" alt="Foto de Perfil" class="profile-pic-large"> 
                                <div class="profile-info">
                                    <h3 id="profile-display-name"></h3>
                                    <p id="profile-email"></p>
                                    <p id="profile-phone"></p>
                                </div>
                            </div>
                            <form id="profile-edit-form" class="profile-edit-form">
                                <h3>Alterar Dados</h3>
                                <div class="input-group">
                                    <label for="edit-display-name">Nome de Exibição</label>
                                    <input type="text" id="edit-display-name" required>
                                </div>
                                <div class="input-group">
                                    <label for="edit-email">Email</label>
                                    <input type="email" id="edit-email">
                                </div>
                                <div class="input-group">
                                    <label for="edit-phone">Celular para Atendimento (WhatsApp)</label>
                                    <input type="tel" id="edit-phone" placeholder="Ex: 62988887777">
                                </div>
                                <div class="input-group profile-pic-upload-container">
                                    <label for="edit-profile-pic">Alterar Foto de Perfil</label>
                                    <input type="file" id="edit-profile-pic" accept="image/*">
                                    <button type="button" id="upload-profile-pic-button">Carregar Foto</button>
                                </div>
                                <button type="submit" class="action-button">Salvar Alterações do Perfil</button>
                                <button type="button" id="open-change-password-modal" class="action-button secondary">Alterar Senha</button>
                                <p id="profile-feedback" class="profile-feedback"></p>
                            </form>
                        </div>
                    </section>

                    <section id="marketing-section" class="content-section">
                        <h2>Conteúdo para Marketing</h2>
                        <p>Aqui você encontra materiais visuais e informativos para suas campanhas de marketing da Galvão Drones.</p>
                        <div class="marketing-content">
                            <!-- Marketing items -->
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </div>
    
    <button id="scroll-to-top" title="Voltar ao topo">⬆</button>
    <button id="ai-chat-button" title="Falar com a IA">🤖</button>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3 id="modal-title">Aviso</h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- MODAL DE ORÇAMENTO (MULTI-ETAPAS) -->
    <div id="request-quote-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3>Solicitar Orçamento - Etapa 1/3</h3>
            <p>Selecione o tipo de item que você precisa:</p>
            <div id="quote-step-1">
                <div class="input-group">
                    <label><input type="radio" name="quote-type" value="PEÇAS"> Peças</label>
                </div>
                <div class="input-group">
                    <label><input type="radio" name="quote-type" value="EQUIPAMENTOS"> Equipamentos</label>
                </div>
            </div>
            
            <div id="quote-step-2" class="hidden">
                <hr>
                <p>Selecione a linha do equipamento:</p>
                <label><input type="radio" name="equipment-line" value="Consumer"> Consumer</label>
                <label><input type="radio" name="equipment-line" value="Enterprise"> Enterprise</label>
                <label><input type="radio" name="equipment-line" value="Agriculture"> Agriculture</label>
            </div>

            <div id="quote-step-3" class="hidden">
                <hr>
                <div class="input-group">
                    <label for="quote-details-text">Descreva os itens e quantidades:</label>
                    <textarea id="quote-details-text" rows="5" placeholder="Ex: 1x DJI Mavic 3 (versão Combo), 2x Baterias extras para DJI Air 2S..."></textarea>
                </div>
            </div>
            <button id="quote-next-step-btn" class="action-button" style="width: auto; margin-top: 20px;">Avançar</button>
        </div>
    </div>

    <!-- MODAL DE CONFIRMAÇÃO DE ORÇAMENTO -->
    <div id="quote-confirmation-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close-button">×</span>
            <h3>Revisar e Enviar Orçamento</h3>
            <p>A mensagem abaixo será enviada para os fornecedores selecionados. Revise e confirme.</p>
            
            <div id="quote-final-suppliers">
                <!-- Lista de fornecedores com checkboxes será preenchida aqui -->
            </div>

            <h4>Mensagem a ser enviada:</h4>
            <textarea id="quote-final-message" rows="8" style="width: 100%; font-size: 0.95em;"></textarea>

            <div class="profile-info-options" style="margin-top: 15px;">
                <h4>Incluir Informações Adicionais:</h4>
                <label><input type="checkbox" class="quote-info-checkbox" data-key="senderName"> Nome do Atendente</label>
                <label><input type="checkbox" class="quote-info-checkbox" data-key="senderWhatsapp"> WhatsApp do Atendente</label>
                <label><input type="checkbox" class="quote-info-checkbox" data-key="companyCnpj"> CNPJ (Galvão Drones)</label>
                <label><input type="checkbox" class="quote-info-checkbox" data-key="companyAddress"> Endereço de Entrega (Galvão Drones)</label>
                <label><input type="checkbox" class="quote-info-checkbox" data-key="companyEmail"> E-mail (Galvão Drones)</label>
            </div>
            
            <button id="send-quote-whatsapp-btn" class="action-button whatsapp-button" style="width: auto; margin-top: 20px;">Confirmar e Abrir WhatsApp</button>
        </div>
    </div>

    <div id="ai-chat-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h3>Fale com a IA da Galvão Drones</h3>
            <div id="ai-chat-modal-body">
                <div class="input-group">
                    <label for="ai-question-input">Qual a sua pergunta?</label>
                    <textarea id="ai-question-input" rows="4" placeholder="Ex: Quais as principais diferenças entre o DJI Mini 4 Pro e o Air 3S?"></textarea>
                </div>
                <button id="submit-ai-question" class="action-button">Enviar Pergunta</button>
                <div class="loader" style="display: none;"></div>
                <div id="ai-response-area" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <div id="supplier-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="supplier-password-close-button">×</span>
            <h3>Acesso Restrito</h3>
            <p>Por favor, digite a senha para acessar as informações de fornecedores:</p>
            <div class="input-group">
                <input type="password" id="supplier-access-password" placeholder="Digite a senha">
            </div>
            <button id="submit-supplier-password" class="action-button">Acessar</button>
            <p id="supplier-password-error" class="error-message">Senha incorreta.</p>
        </div>
    </div>

    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="change-password-close-button">×</span>
            <h3 id="change-password-modal-title">Alterar Senha</h3>
            <p id="change-password-message">Por favor, defina uma nova senha para sua conta.</p>
            <div class="input-group">
                <label for="new-password">Nova Senha (mín. 6 dígitos)</label>
                <input type="password" id="new-password">
            </div>
            <div class="input-group">
                <label for="confirm-new-password">Confirmar Nova Senha</label>
                <input type="password" id="confirm-new-password">
            </div>
            <button id="submit-change-password" class="action-button">Salvar Nova Senha</button>
            <p id="change-password-error" class="error-message">Senhas não conferem ou são muito curtas.</p>
            <p id="change-password-success" class="success-message">Senha alterada com sucesso!</p>
        </div>
    </div>

    <div id="whatsapp-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="whatsapp-close-button">×</span>
            <h3>Personalizar Mensagem do WhatsApp</h3>
            <textarea id="whatsapp-message-input"></textarea>
            <div class="profile-info-options">
                <h4>Incluir Informações do Perfil:</h4>
                <label>
                    <input type="checkbox" id="include-display-name"> Nome de Exibição (<span id="whatsapp-display-name-preview"></span>)
                </label>
                <label>
                    <input type="checkbox" id="include-email"> Email (<span id="whatsapp-email-preview"></span>)
                </label>
                <label>
                    <input type="checkbox" id="include-phone"> Celular para Atendimento (<span id="whatsapp-phone-preview"></span>)
                </label>
            </div>
            <div class="action-button-group">
                <button id="send-whatsapp-button" class="action-button whatsapp-button">Enviar via WhatsApp</button>
                <button id="cancel-whatsapp-button" class="action-button cancel-button">Cancelar</button>
            </div>
        </div>
    </div>
<script>
    // --- VARIÁVEIS GLOBAIS ---
    const currentYear = new Date().getFullYear(); 

    const USERS = {
        'mikhaell': { password: 'mk0639', role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Mikhaell Galvão', email: 'contato@galvaodrones.com.br', phone: '6236360668', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' }, 
        'Maikhon':  { password: `mai${currentYear}`, role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Maikhon', email: 'maikhon@galvaodrones.com.br', phone: '62987654321', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
        'Ryan':     { password: `rya${currentYear}`, role: 'admin', type: 'permanent', firstLogin: false, displayName: 'Ryan', email: 'ryan@galvaodrones.com.br', phone: '62912345678', profilePicUrl: 'https://i.imgur.com/8Yd00YF.png' },
    };
    const CONFIDENTIAL_CODE = '@0639'; 

    let PRODUCTS = [ 
        { id: 1, name: 'DJI Neo Standard', spec: '...', salePrice: 1900, line: 'Consumer', sources: [{ supplierName: 'Arroba Celulares', costPrice: 1340 }] },
        { id: 39, name: 'DJI Mavic 3 Multispectral', spec: '...', salePrice: 44302.70, line: 'Agriculture', sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 31011.89 }] }, 
        { id: 40, name: 'DJI Mavic 3 Thermal', spec: '...', salePrice: 42533.55, line: 'Enterprise', sources: [{ supplierName: 'GoHobby Distribuidora de VANT LTDA', costPrice: 29773.48 }] }, 
    ];

    let SUPPLIERS = [
        { id: 1, name: 'Arroba Celulares', details: 'Aroba celulares é um dos principais distribuidores...', payment: '...', products: '...', categories: ['Consumer', 'Peças'], contacts: [{ name: 'Contato Principal', role: 'Vendas', whatsapp: '62911111111' }] },
        { id: 2, name: 'DJI Grupo Multi', details: 'Atuam desde 2012 no mercado de drones...', payment: '...', products: '...', categories: ['Consumer', 'Peças'], contacts: [{ name: 'Contato Principal', role: 'Vendas', whatsapp: '62922222222' }] },
        { id: 3, name: 'GoHobby Distribuidora de VANT LTDA', details: 'A GoHobby é importadora exclusiva...', payment: '...', products: '...', categories: ['Enterprise', 'Agriculture', 'Peças'], contacts: [{ name: 'Contato Principal', role: 'Vendas', whatsapp: '62933333333' }] },
        { 
            id: 4, 
            name: 'Agrobox Drones', 
            details: 'Peças e Equipamentos para Agricultura. Local: Goiânia, Goiás.', 
            payment: 'A combinar.', 
            products: 'Peças e Equipamentos para Drones Agrícolas', 
            categories: ['Agriculture', 'Equipamentos', 'Peças'],
            contacts: [
                { name: 'Frederico', role: 'Dono', whatsapp: '62999999999' },
                { name: 'Marcos', role: 'Gerente', whatsapp: '62999999998' },
                { name: 'Heverton', role: 'Vendedor', whatsapp: '62999999997' }
            ]
        }
    ];

    const INSTALLMENT_RATES = { 1: 0.0309, 2: 0.0579, 3: 0.0609, 4: 0.0799, 5: 0.0809, 6: 0.0818, 7: 0.0949, 8: 0.0966, 9: 0.1037, 10: 0.1105, 11: 0.1227, 12: 0.1238 };

    // --- ELEMENTOS DO DOM ---
    let loginScreen, appScreen, loginButton, logoutButton, usernameInput, passwordInput, loginError, visitorModeButton;
    let navButtons, contentSections, productsNavButton, calculatorNavButton, suppliersNavButton, settingsNavButton, dronesNavButton, infoEmpresaNavButton, marketingNavButton, profileNavButton;
    let productList, supplierList, productSearchInput, droneVisitorList, droneVisitorSearchInput;
    let mainModal, modalTitle, modalBody, closeModalButton;
    let mainContent, scrollToTopButton, aiChatButton;
    let navToggleButton, navToggleButtonClose, navElement;
    let createSupplierBtn, editSupplierBtn, requestQuoteBtn, supplierFilterBtn, droneFilterBtn;
    let requestQuoteModal, quoteNextStepBtn, quoteConfirmationModal, sendQuoteWhatsappBtn;

    // --- FUNÇÕES DE RENDERIZAÇÃO ---
    function renderDroneVisitorList(filters = {}) {
        const droneVisitorListEl = document.getElementById('drone-visitor-list');
        droneVisitorListEl.innerHTML = '';
        const { searchTerm = '', sortOrder = 'alpha', lines = [] } = filters;
        let dronesToShow = PRODUCTS.filter(p => p.name.toLowerCase().includes('dji') || p.name.toLowerCase().includes('drone'));

        if (lines.length > 0) {
            dronesToShow = dronesToShow.filter(p => lines.includes(p.line));
        }
        if (searchTerm) {
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            dronesToShow = dronesToShow.filter(p => p.name.toLowerCase().includes(lowerCaseSearchTerm) || p.spec.toLowerCase().includes(lowerCaseSearchTerm));
        }
        if (sortOrder === 'alpha') dronesToShow.sort((a, b) => a.name.localeCompare(b.name));
        else if (sortOrder === 'price-asc') dronesToShow.sort((a, b) => a.salePrice - b.salePrice);
        else if (sortOrder === 'price-desc') dronesToShow.sort((a, b) => b.salePrice - a.salePrice);

        dronesToShow.forEach(product => {
            const droneCard = document.createElement('div');
            droneCard.className = 'card product-card';
            droneCard.innerHTML = `<h3>${product.name}</h3><p class="product-spec">${product.spec}</p><p class="price">${product.salePrice > 0 ? product.salePrice.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) : 'Consultar valor'}</p>`;
            droneVisitorListEl.appendChild(droneCard);
        });
    }

    function renderSuppliers(filters = {}) {
        const supplierListEl = document.getElementById('supplier-list');
        supplierListEl.innerHTML = '';
        const { sortOrder = 'alpha', categories = [] } = filters;
        let suppliersToShow = [...SUPPLIERS];

        if (categories.length > 0) {
            suppliersToShow = suppliersToShow.filter(s => s.categories.some(cat => categories.includes(cat)));
        }
        if (sortOrder === 'alpha') suppliersToShow.sort((a, b) => a.name.localeCompare(b.name));

        suppliersToShow.forEach(supplier => {
            const supplierCard = document.createElement('div');
            supplierCard.className = 'card supplier-card';
            let contactsHTML = '<ul class="contact-list">';
            supplier.contacts.forEach(contact => {
                contactsHTML += `<li><div class="contact-info"><strong>${contact.name}</strong> - <span>${contact.role}</span></div><a href="https://wa.me/55${contact.whatsapp}" target="_blank" class="whatsapp-contact-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/></svg></a></li>`;
            });
            contactsHTML += '</ul>';
            let categoriesHTML = '<div class="categories">';
            supplier.categories.forEach(cat => { categoriesHTML += `<span class="category-tag">${cat}</span>`; });
            categoriesHTML += '</div>';
            supplierCard.innerHTML = `<h3>${supplier.name}</h3><p>${supplier.details}</p>${categoriesHTML}${contactsHTML}`;
            supplierListEl.appendChild(supplierCard);
        });
    }

    // --- FUNÇÕES DE ORÇAMENTO ---
    function openRequestQuoteModal() {
        requestQuoteModal.style.display = 'block';
        document.getElementById('quote-step-1').classList.remove('hidden');
        document.getElementById('quote-step-2').classList.add('hidden');
        document.getElementById('quote-step-3').classList.add('hidden');
        document.getElementById('quote-details-text').value = '';
        document.querySelectorAll('input[name="quote-type"]').forEach(r => r.checked = false);
        document.querySelectorAll('input[name="equipment-line"]').forEach(r => r.checked = false);
        window.currentQuoteState = { step: 1 };
    }

    function handleQuoteNextStep() {
        const step1 = document.getElementById('quote-step-1');
        const step2 = document.getElementById('quote-step-2');
        const step3 = document.getElementById('quote-step-3');
        if (window.currentQuoteState.step === 1) {
            const quoteType = document.querySelector('input[name="quote-type"]:checked');
            if (!quoteType) { alert('Por favor, selecione um tipo de item.'); return; }
            window.currentQuoteState.type = quoteType.value;
            step1.classList.add('hidden');
            if (quoteType.value === 'EQUIPAMENTOS') {
                step2.classList.remove('hidden');
                window.currentQuoteState.step = 2;
            } else {
                step3.classList.remove('hidden');
                window.currentQuoteState.step = 3;
            }
        } else if (window.currentQuoteState.step === 2) {
            const equipmentLine = document.querySelector('input[name="equipment-line"]:checked');
            if (!equipmentLine) { alert('Por favor, selecione a linha do equipamento.'); return; }
            window.currentQuoteState.line = equipmentLine.value;
            step2.classList.add('hidden');
            step3.classList.remove('hidden');
            window.currentQuoteState.step = 3;
        } else if (window.currentQuoteState.step === 3) {
            const details = document.getElementById('quote-details-text').value.trim();
            if (!details) { alert('Por favor, descreva os itens necessários.'); return; }
            window.currentQuoteState.details = details;
            requestQuoteModal.style.display = 'none';
            generateAndShowQuoteConfirmation();
        }
    }

    function generateAndShowQuoteConfirmation() {
        const { type, line, details } = window.currentQuoteState;
        let targetCategories = [type];
        if (line) targetCategories.push(line);
        if (type === 'PEÇAS') targetCategories.push('Peças');
        const relevantSuppliers = SUPPLIERS.filter(s => s.categories.some(cat => targetCategories.includes(cat)));
        if (relevantSuppliers.length === 0) { alert('Nenhum fornecedor encontrado para a categoria selecionada.'); return; }

        const hour = new Date().getHours();
        let greeting = (hour >= 5 && hour < 12) ? 'Bom dia' : (hour >= 12 && hour < 18) ? 'Boa tarde' : 'Boa noite';
        const senderName = window.currentUser.displayName || window.currentUser.username;
        let message = `${greeting}! Tudo bem?\n\nMeu nome é ${senderName}, falo em nome da Galvão Drones. Gostaria de solicitar um orçamento para os seguintes itens, bem como o prazo estimado para entrega:\n\n--- LISTA DE ITENS ---\n${details}\n\nAgradeço a atenção e aguardo o retorno.`;
        
        quoteConfirmationModal.style.display = 'block';
        document.getElementById('quote-final-message').value = message;
        const suppliersDiv = document.getElementById('quote-final-suppliers');
        suppliersDiv.innerHTML = '<h4>Selecione os fornecedores para enviar:</h4>';
        relevantSuppliers.forEach(s => { 
            suppliersDiv.innerHTML += `<div><label><input type="checkbox" class="quote-supplier-checkbox" value="${s.id}" checked> ${s.name}</label></div>`;
        });
        window.finalQuoteInfo = { message, suppliers: relevantSuppliers };
    }

    function sendQuoteViaWhatsApp() {
        let finalMessage = document.getElementById('quote-final-message').value;
        const infoToAdd = [];
        document.querySelectorAll('.quote-info-checkbox:checked').forEach(cb => {
            const key = cb.dataset.key;
            if (key === 'senderName') infoToAdd.push(`Atendente: ${window.currentUser.displayName}`);
            if (key === 'senderWhatsapp' && window.currentUser.phone) infoToAdd.push(`WhatsApp: ${window.currentUser.phone}`);
            if (key === 'companyCnpj') infoToAdd.push(`CNPJ: 60.102.179/0001-10`);
            if (key === 'companyAddress') infoToAdd.push(`Endereço: Rua 16, nº 304 – Setor Aeroviário, Goiânia – GO, CEP: 74435-240`);
            if (key === 'companyEmail') infoToAdd.push(`E-mail: contato@galvaodrones.com.br`);
        });
        if (infoToAdd.length > 0) {
            finalMessage += `\n\n--- DADOS PARA CADASTRO/ENVIO ---\n${infoToAdd.join('\n')}`;
        }
        const encodedMessage = encodeURIComponent(finalMessage);

        const selectedSupplierIds = [...document.querySelectorAll('.quote-supplier-checkbox:checked')].map(cb => parseInt(cb.value));
        
        if(selectedSupplierIds.length === 0) {
            alert("Por favor, selecione pelo menos um fornecedor.");
            return;
        }

        const selectedSuppliers = SUPPLIERS.filter(s => selectedSupplierIds.includes(s.id));

        selectedSuppliers.forEach(supplier => {
            if (supplier.contacts && supplier.contacts.length > 0) {
                const primaryContact = supplier.contacts[0];
                window.open(`https://wa.me/55${primaryContact.whatsapp}?text=${encodedMessage}`, '_blank');
            }
        });
        quoteConfirmationModal.style.display = 'none';
    }

    // --- LÓGICA DE AUTENTICAÇÃO E SETUP ---
    function handleLogin() {
        const usernameVal = usernameInput.value;
        const passwordVal = passwordInput.value;
        const user = USERS[usernameVal];
        if (user && user.password === passwordVal) {
            window.currentUser = { ...user, username: usernameVal };
            loginScreen.style.display = 'none';
            appScreen.style.display = 'block';
            document.body.classList.remove('visitor-mode-bg');
            setupAppForUser();
        } else {
            loginError.style.display = 'block';
        }
    }

    function handleVisitorMode() {
        window.currentUser = { username: 'Visitante', role: 'visitor', isVisitor: true, displayName: 'Visitante' };
        loginScreen.style.display = 'none';
        appScreen.style.display = 'block';
        document.body.classList.add('visitor-mode-bg');
        setupAppForUser();
    }

    function setupAppForUser() {
        const isVisitor = window.currentUser.isVisitor;
        const isAdmin = window.currentUser.role === 'admin';
        document.getElementById('welcome-message').textContent = `Olá, ${window.currentUser.displayName || window.currentUser.username}!`;
        
        productsNavButton.style.display = isVisitor ? 'none' : 'block';
        calculatorNavButton.style.display = isVisitor ? 'none' : 'block';
        suppliersNavButton.style.display = isAdmin ? 'block' : 'none';
        settingsNavButton.style.display = isAdmin ? 'block' : 'none';
        dronesNavButton.style.display = 'block';
        infoEmpresaNavButton.style.display = 'block';
        marketingNavButton.style.display = isAdmin ? 'block' : 'none';
        profileNavButton.classList.toggle('hidden', isVisitor);

        if (isVisitor) {
            switchTab('drones-visitor-section');
        } else {
            switchTab('products-section');
        }
    }

    function switchTab(sectionId) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        const newSection = document.getElementById(sectionId);
        if (newSection) newSection.classList.add('active');
        
        document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
        const newButton = document.querySelector(`.nav-button[data-section="${sectionId}"]`);
        if (newButton) newButton.classList.add('active');

        if (sectionId === 'suppliers-section') renderSuppliers();
        if (sectionId === 'drones-visitor-section') renderDroneVisitorList();
    }

    // --- INICIALIZAÇÃO ---
    document.addEventListener('DOMContentLoaded', () => {
        loginScreen = document.getElementById('login-screen');
        appScreen = document.getElementById('app-screen');
        loginButton = document.getElementById('login-button');
        logoutButton = document.getElementById('logout-button');
        usernameInput = document.getElementById('username');
        passwordInput = document.getElementById('password');
        loginError = document.getElementById('login-error');
        visitorModeButton = document.getElementById('visitor-mode-button');
        productsNavButton = document.getElementById('products-nav-button');
        calculatorNavButton = document.getElementById('calculator-nav-button');
        suppliersNavButton = document.getElementById('suppliers-nav-button');
        settingsNavButton = document.getElementById('settings-nav-button');
        dronesNavButton = document.getElementById('drones-nav-button');
        infoEmpresaNavButton = document.getElementById('info-empresa-nav-button');
        marketingNavButton = document.getElementById('marketing-nav-button');
        profileNavButton = document.getElementById('profile-nav-button');
        navToggleButton = document.getElementById('nav-toggle-btn');
        navToggleButtonClose = document.getElementById('nav-toggle-btn-close');
        navElement = document.querySelector('nav');
        supplierFilterBtn = document.getElementById('supplier-filter-btn');
        droneFilterBtn = document.getElementById('drone-filter-btn');
        requestQuoteBtn = document.getElementById('request-quote-btn');
        requestQuoteModal = document.getElementById('request-quote-modal');
        quoteNextStepBtn = document.getElementById('quote-next-step-btn');
        quoteConfirmationModal = document.getElementById('quote-confirmation-modal');
        sendQuoteWhatsappBtn = document.getElementById('send-quote-whatsapp-btn');
        droneVisitorSearchInput = document.getElementById('drone-visitor-search');

        loginButton.addEventListener('click', handleLogin);
        visitorModeButton.addEventListener('click', handleVisitorMode);
        logoutButton.addEventListener('click', () => { location.reload(); });
        navToggleButton.addEventListener('click', () => navElement.classList.toggle('nav-open'));
        navToggleButtonClose.addEventListener('click', () => navElement.classList.remove('nav-open'));
        
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                if(button.dataset.section) switchTab(button.dataset.section);
                navElement.classList.remove('nav-open');
            });
        });
        
        supplierFilterBtn.addEventListener('click', (e) => { e.stopPropagation(); document.getElementById('supplier-filter-options').classList.toggle('show'); });
        droneFilterBtn.addEventListener('click', (e) => { e.stopPropagation(); document.getElementById('drone-filter-options').classList.toggle('show'); });
        window.addEventListener('click', (e) => {
            if (!e.target.closest('.filter-container')) {
                document.getElementById('supplier-filter-options').classList.remove('show');
                document.getElementById('drone-filter-options').classList.remove('show');
            }
        });
        document.getElementById('supplier-filter-options').addEventListener('change', () => {
            const sortOrder = document.querySelector('input[name="sort-supplier"]:checked').value;
            const categories = [...document.querySelectorAll('input[name="cat-supplier"]:checked')].map(cb => cb.value);
            renderSuppliers({ sortOrder, categories });
        });
        document.getElementById('drone-filter-options').addEventListener('change', () => {
            const sortOrder = document.getElementById('sort-drone-order').value;
            const lines = [...document.querySelectorAll('input[name="line-drone"]:checked')].map(cb => cb.value);
            renderDroneVisitorList({ searchTerm: droneVisitorSearchInput.value, sortOrder, lines });
        });
        droneVisitorSearchInput.addEventListener('input', (e) => {
             const sortOrder = document.getElementById('sort-drone-order').value;
             const lines = [...document.querySelectorAll('input[name="line-drone"]:checked')].map(cb => cb.value);
             renderDroneVisitorList({ searchTerm: e.target.value, sortOrder, lines });
        });

        requestQuoteBtn.addEventListener('click', openRequestQuoteModal);
        quoteNextStepBtn.addEventListener('click', handleQuoteNextStep);
        sendQuoteWhatsappBtn.addEventListener('click', sendQuoteViaWhatsApp);
        document.querySelectorAll('.modal .close-button').forEach(btn => {
            btn.addEventListener('click', (e) => { e.target.closest('.modal').style.display = 'none'; });
        });
    });
</script>
</body>
</html>

